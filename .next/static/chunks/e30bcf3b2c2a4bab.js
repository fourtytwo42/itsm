(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,37940,e=>{"use strict";var t=e.i(18050),r=e.i(71645),o=e.i(18566),a=e.i(22016),n=e.i(42969),s=e.i(27217),i=e.i(16965),l=e.i(82092),d=e.i(60759),c=e.i(18789),g=e.i(42531),h=e.i(30562);let m=e=>`ai-chat-messages-tenant-${e}`;function p({tenantId:e}){let[o,a]=(0,r.useState)(!1),[p,u]=(0,r.useState)(!1),[x,y]=(0,r.useState)(null),[f,b]=(0,r.useState)(()=>(e=>{try{let t=localStorage.getItem(m(e));if(t){let e=JSON.parse(t);if(Array.isArray(e)&&e.length>0)return e}}catch(e){console.error("Failed to load chat from localStorage:",e)}return[{role:"assistant",content:"Hi! I'm your IT support assistant. What issue are you experiencing?"}]})(e)),[v,j]=(0,r.useState)(""),[S,k]=(0,r.useState)(!1),w=(0,r.useRef)(null),C=(0,r.useRef)(null),T=(0,r.useRef)(!1);(0,r.useEffect)(()=>{w.current?.scrollIntoView({behavior:"smooth"})},[f]),(0,r.useEffect)(()=>{!S&&T.current&&C.current&&setTimeout(()=>{C.current?.focus()},100)},[f,S]);let I=(0,r.useRef)(!1);(0,r.useEffect)(()=>{if(I.current){I.current=!1;return}if(f.length>0)try{localStorage.setItem(m(e),JSON.stringify(f))}catch(e){console.error("Failed to save chat to localStorage:",e)}},[f,e]);let E=async()=>{if(!v.trim()||S)return void console.log("[TenantChatWidget] handleSend: Skipping - input empty or already loading",{input:v.trim(),loading:S,tenantId:e});let t=[...f,{role:"user",content:v}];console.log("[TenantChatWidget] handleSend: Starting",{messageCount:t.length,userMessage:v.substring(0,50),tenantId:e}),b(t),j(""),k(!0);try{let r,o=localStorage.getItem("accessToken"),a={messages:t.map(e=>({role:e.role,content:e.content})),tenantId:e};console.log("[TenantChatWidget] handleSend: Sending request",{messageCount:a.messages.length,hasToken:!!o,tenantId:e});let n=new AbortController,s=setTimeout(()=>{console.error("[TenantChatWidget] handleSend: Request timeout after 60s",{tenantId:e}),n.abort()},6e4);try{r=await fetch("/api/v1/ai/chat",{method:"POST",headers:{"Content-Type":"application/json",...o&&{Authorization:`Bearer ${o}`}},body:JSON.stringify(a),signal:n.signal}),clearTimeout(s)}catch(e){if(clearTimeout(s),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - the server took too long to respond. Please try again.");throw e}if(console.log("[TenantChatWidget] handleSend: Response received",{status:r.status,ok:r.ok,tenantId:e}),!r.ok){let t=await r.text();throw console.error("[TenantChatWidget] handleSend: HTTP Error",{status:r.status,statusText:r.statusText,errorText:t.substring(0,200),tenantId:e}),Error(`HTTP ${r.status}: ${r.statusText}`)}let i=await r.json();if(console.log("[TenantChatWidget] handleSend: Response parsed",{success:i.success,hasReply:!!i.data?.reply,replyLength:i.data?.reply?.length||0,tenantId:e}),!i.success)throw console.error("[TenantChatWidget] handleSend: API Error Response",{error:i.error,errorCode:i.error?.code,errorMessage:i.error?.message,tenantId:e}),Error(i.error?.message||"Failed to get response");if(!i.data?.reply)throw console.error("[TenantChatWidget] handleSend: No reply in response",{data:i,tenantId:e}),Error("No reply received from server");i.data.conversationId&&(console.log("[TenantChatWidget] handleSend: Conversation ID updated",{conversationId:i.data.conversationId,tenantId:e}),y(i.data.conversationId));let l={role:"assistant",content:i.data.reply};console.log("[TenantChatWidget] handleSend: Adding assistant message",{messageLength:l.content.length,tenantId:e}),b(t=>{let r=[...t,l];return console.log("[TenantChatWidget] handleSend: Messages updated",{totalMessages:r.length,tenantId:e}),r})}catch(r){console.error("[TenantChatWidget] handleSend: Exception caught",{error:r,errorMessage:r instanceof Error?r.message:String(r),errorStack:r instanceof Error?r.stack:void 0,tenantId:e});let t={role:"assistant",content:`Sorry, I encountered an error. Please try again or create a support ticket. Error: ${r instanceof Error?r.message:"Unknown error"}`};b(e=>[...e,t])}finally{console.log("[TenantChatWidget] handleSend: Finalizing (setting loading to false)",{tenantId:e}),k(!1)}};return o?(0,t.jsxs)("div",{style:p?{position:"fixed",top:0,left:0,right:0,bottom:0,width:"100vw",height:"100vh",backgroundColor:"var(--bg-secondary)",border:"none",borderRadius:0,boxShadow:"none",display:"flex",flexDirection:"column",zIndex:9999}:{position:"fixed",bottom:"2rem",right:"2rem",width:"600px",maxWidth:"calc(100vw - 40px)",height:"800px",maxHeight:"calc(100vh - 40px)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"12px",boxShadow:"0 8px 24px var(--shadow)",display:"flex",flexDirection:"column",zIndex:1e3},children:[(0,t.jsxs)("div",{style:{padding:"0.75rem",borderBottom:"1px solid var(--border-color)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,t.jsx)("h3",{style:{margin:0,fontWeight:"600",fontSize:"0.875rem"},children:"AI Assistant"}),(0,t.jsxs)("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[(0,t.jsx)("button",{onClick:()=>{I.current=!0;try{localStorage.removeItem(m(e))}catch(e){console.error("Failed to clear chat from localStorage:",e)}y(null);let t=[{role:"assistant",content:"Hi! I'm your IT support assistant. What issue are you experiencing?"}];b(t);try{localStorage.setItem(m(e),JSON.stringify(t))}catch(e){console.error("Failed to save cleared chat to localStorage:",e)}},style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center"},"aria-label":"Clear chat",title:"Clear chat",children:(0,t.jsx)(d.TrashIcon,{style:{width:"20px",height:"20px"}})}),(0,t.jsx)("button",{onClick:()=>{u(!p)},style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center"},"aria-label":p?"Exit fullscreen":"Enter fullscreen",title:p?"Exit fullscreen":"Enter fullscreen",children:p?(0,t.jsx)(l.ArrowsPointingInIcon,{style:{width:"20px",height:"20px"}}):(0,t.jsx)(i.ArrowsPointingOutIcon,{style:{width:"20px",height:"20px"}})}),(0,t.jsx)("button",{onClick:()=>a(!1),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem"},"aria-label":"Close chat",children:(0,t.jsx)(s.XMarkIcon,{style:{width:"20px",height:"20px"}})})]})]}),(0,t.jsxs)("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[f.map((e,r)=>(0,t.jsx)("div",{style:{alignSelf:"user"===e.role?"flex-end":"flex-start",maxWidth:"80%",padding:"0.5rem 0.75rem",borderRadius:"12px",backgroundColor:"user"===e.role?"var(--accent-primary)":"var(--bg-tertiary)",color:"user"===e.role?"white":"var(--text-primary)",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap",fontSize:"0.8125rem",lineHeight:1.5},children:"assistant"===e.role?(0,t.jsx)("div",{style:{lineHeight:1.4,fontSize:"0.8125rem"},children:(0,t.jsx)(c.default,{remarkPlugins:[g.default],rehypePlugins:[h.default],components:{p:({children:e})=>(0,t.jsx)("p",{style:{margin:"0 0 0.375rem 0",fontSize:"0.8125rem"},children:e}),ul:({children:e})=>(0,t.jsx)("ul",{style:{margin:"0 0 0.5rem 0",paddingLeft:"1.5rem"},children:e}),ol:({children:e})=>(0,t.jsx)("ol",{style:{margin:"0 0 0.5rem 0",paddingLeft:"1.5rem"},children:e}),li:({children:e})=>(0,t.jsx)("li",{style:{margin:"0.25rem 0"},children:e}),code:({children:e,className:r})=>(0,t.jsx)("code",{style:{backgroundColor:"rgba(0,0,0,0.1)",padding:"0.15rem 0.3rem",borderRadius:"4px",fontSize:"0.75em",fontFamily:"monospace"},children:e}),pre:({children:e})=>(0,t.jsx)("pre",{style:{backgroundColor:"rgba(0,0,0,0.1)",padding:"0.5rem",borderRadius:"8px",overflowX:"auto",margin:"0.375rem 0",fontSize:"0.75em",fontFamily:"monospace"},children:e}),a:({children:e,href:r})=>(0,t.jsx)("a",{href:r,target:"_blank",rel:"noopener noreferrer",style:{color:"inherit",textDecoration:"underline"},children:e}),strong:({children:e})=>(0,t.jsx)("strong",{style:{fontWeight:600},children:e}),em:({children:e})=>(0,t.jsx)("em",{style:{fontStyle:"italic"},children:e})},children:e.content})}):(0,t.jsx)("div",{style:{fontSize:"0.8125rem"},children:e.content})},r)),S&&(0,t.jsx)("div",{style:{alignSelf:"flex-start",padding:"0.5rem 0.75rem",borderRadius:"12px",backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)",fontSize:"0.8125rem"},children:"Thinking..."}),(0,t.jsx)("div",{ref:w})]}),(0,t.jsxs)("div",{style:{padding:"0.75rem",borderTop:"1px solid var(--border-color)",display:"flex",gap:"0.5rem"},children:[(0,t.jsx)("input",{ref:C,type:"text",value:v,onChange:e=>j(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),E())},onFocus:()=>{T.current=!0},onBlur:()=>{setTimeout(()=>{document.activeElement!==C.current&&(T.current=!1)},100)},placeholder:"Type your message...",disabled:S,style:{flex:1,padding:"0.5rem 0.75rem",border:"1px solid var(--border-color)",borderRadius:"8px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.75rem"}}),(0,t.jsx)("button",{onClick:E,disabled:S||!v.trim(),style:{padding:"0.5rem 0.75rem",backgroundColor:"var(--accent-primary)",color:"white",border:"none",borderRadius:"8px",cursor:S||!v.trim()?"not-allowed":"pointer",opacity:S||!v.trim()?.5:1},children:(0,t.jsx)(n.PaperAirplaneIcon,{style:{width:"20px",height:"20px"}})})]})]}):(0,t.jsx)("button",{onClick:()=>a(!0),style:{position:"fixed",bottom:"2rem",right:"2rem",width:"60px",height:"60px",borderRadius:"50%",backgroundColor:"var(--accent-primary)",color:"white",border:"none",cursor:"pointer",boxShadow:"0 4px 12px var(--shadow)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},"aria-label":"Open chat",children:(0,t.jsx)(n.PaperAirplaneIcon,{style:{width:"24px",height:"24px"}})})}function u(){let e=(0,o.useParams)(),n=(0,o.useRouter)(),s=e?.slug,[i,l]=(0,r.useState)(null),[d,c]=(0,r.useState)(!0),[g,h]=(0,r.useState)(""),[m,u]=(0,r.useState)(!1),[x,y]=(0,r.useState)([]),[f,b]=(0,r.useState)(!1),[v,j]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=localStorage.getItem("accessToken");if(u(!!e),!e){let e=localStorage.getItem("publicToken");e?j(e):S()}k()},[s]),(0,r.useEffect)(()=>{i&&w()},[i,m,v]);let S=async e=>{try{let t=await fetch("/api/v1/public/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tenantId:e||null})}),r=await t.json();r.success&&(localStorage.setItem("publicToken",r.data.token),localStorage.setItem("publicTokenId",r.data.publicId),j(r.data.token))}catch(e){}};(0,r.useEffect)(()=>{!i||m||v||S(i.id)},[i?.id,m]);let k=async()=>{try{c(!0);let e=await fetch(`/api/v1/tenants/${s}`),t=await e.json();t.success?(l(t.data),t.data.requiresLogin&&!m&&n.push(`/login?redirect=/tenant/${s}`)):h(t.error?.message||"Tenant not found")}catch(e){h("Failed to load tenant")}finally{c(!1)}},w=async()=>{try{b(!0);let e=localStorage.getItem("accessToken"),t=v||localStorage.getItem("publicToken"),r={"Content-Type":"application/json"};e?r.Authorization=`Bearer ${e}`:t&&(r.Authorization=`Bearer ${t}`);let o=await fetch(`/api/v1/tenants/${s}/tickets`,{headers:r}),a=await o.json();a.success&&(y(a.data),a.data.length>0&&localStorage.setItem(`tickets_${s}`,JSON.stringify(a.data)))}catch(t){let e=localStorage.getItem(`tickets_${s}`);if(e)try{y(JSON.parse(e))}catch(e){}}finally{b(!1)}};return d?(0,t.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,t.jsx)("p",{children:"Loading..."})}):g||!i?(0,t.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,t.jsxs)("div",{style:{textAlign:"center"},children:[(0,t.jsx)("h1",{style:{fontSize:"2rem",marginBottom:"1rem"},children:"Tenant Not Found"}),(0,t.jsx)("p",{style:{color:"var(--text-secondary)"},children:g||"The tenant you are looking for does not exist."})]})}):(0,t.jsxs)("div",{style:{minHeight:"100vh",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)"},children:[(0,t.jsx)("header",{style:{padding:"2rem",borderBottom:"1px solid var(--border-color)",backgroundColor:"var(--bg-secondary)"},children:(0,t.jsxs)("div",{style:{maxWidth:"1200px",margin:"0 auto",display:"flex",alignItems:"center",gap:"1rem"},children:[i.logo&&(0,t.jsx)("img",{src:i.logo,alt:i.name,style:{width:"64px",height:"64px",borderRadius:"8px"}}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{style:{fontSize:"2rem",margin:0},children:i.name}),i.description&&(0,t.jsx)("p",{style:{color:"var(--text-secondary)",marginTop:"0.5rem"},children:i.description})]})]})}),(0,t.jsx)("nav",{style:{padding:"1rem 2rem",borderBottom:"1px solid var(--border-color)",backgroundColor:"var(--bg-secondary)"},children:(0,t.jsxs)("div",{style:{maxWidth:"1200px",margin:"0 auto",display:"flex",gap:"2rem"},children:[(0,t.jsx)(a.default,{href:`/tenant/${s}`,style:{color:"var(--accent-primary)",textDecoration:"none",fontWeight:600},children:"Home"}),(0,t.jsx)(a.default,{href:`/tenant/${s}/kb`,style:{color:"var(--text-primary)",textDecoration:"none"},children:"Knowledge Base"}),(0,t.jsx)(a.default,{href:`/tenant/${s}/submit`,style:{color:"var(--text-primary)",textDecoration:"none"},children:"Submit Ticket"})]})}),(0,t.jsx)("main",{style:{maxWidth:"1200px",margin:"0 auto",padding:"2rem"},children:(0,t.jsx)("div",{children:(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{style:{fontSize:"1.5rem",marginBottom:"1rem"},children:["Welcome to ",i.name," Support"]}),(0,t.jsx)("p",{style:{color:"var(--text-secondary)",marginBottom:"2rem"},children:"We're here to help! Browse our knowledge base or submit a support ticket."}),(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"2rem"},children:[(0,t.jsxs)(a.default,{href:`/tenant/${s}/submit`,style:{padding:"1.5rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)",textDecoration:"none",color:"var(--text-primary)",display:"block"},children:[(0,t.jsx)("h3",{style:{margin:0,marginBottom:"0.5rem"},children:"Submit a Ticket"}),(0,t.jsx)("p",{style:{margin:0,color:"var(--text-secondary)",fontSize:"0.875rem"},children:"Get help with your issue"})]}),(0,t.jsxs)(a.default,{href:`/tenant/${s}/kb`,style:{padding:"1.5rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)",textDecoration:"none",color:"var(--text-primary)",display:"block"},children:[(0,t.jsx)("h3",{style:{margin:0,marginBottom:"0.5rem"},children:"Knowledge Base"}),(0,t.jsx)("p",{style:{margin:0,color:"var(--text-secondary)",fontSize:"0.875rem"},children:"Browse articles and FAQs"})]})]}),(m||v||localStorage.getItem("publicToken"))&&(0,t.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,t.jsx)("h3",{style:{fontSize:"1.25rem",margin:0},children:"My Tickets"}),x.length>5&&(0,t.jsx)(a.default,{href:`/tenant/${s}/tickets`,style:{fontSize:"0.875rem",color:"var(--accent-primary)",textDecoration:"none"},children:"View All"})]}),f?(0,t.jsx)("p",{style:{color:"var(--text-secondary)"},children:"Loading tickets..."}):x.length>0?(0,t.jsx)("div",{style:{display:"grid",gap:"1rem"},children:x.slice(0,5).map(e=>(0,t.jsxs)(a.default,{href:`/tenant/${s}/tickets/${e.id}`,style:{padding:"1rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)",textDecoration:"none",color:"var(--text-primary)",display:"block"},children:[(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[(0,t.jsx)("span",{style:{fontWeight:600},children:e.ticketNumber}),(0,t.jsx)("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"12px",fontSize:"0.75rem",fontWeight:600,backgroundColor:"OPEN"===e.status||"NEW"===e.status?"rgba(59, 130, 246, 0.1)":"RESOLVED"===e.status||"CLOSED"===e.status?"rgba(16, 185, 129, 0.1)":"rgba(156, 163, 175, 0.1)",color:"OPEN"===e.status||"NEW"===e.status?"rgb(59, 130, 246)":"RESOLVED"===e.status||"CLOSED"===e.status?"rgb(16, 185, 129)":"rgb(156, 163, 175)"},children:e.status})]}),(0,t.jsx)("h4",{style:{margin:0,marginBottom:"0.25rem"},children:e.subject}),(0,t.jsx)("p",{style:{margin:0,color:"var(--text-secondary)",fontSize:"0.875rem"},children:new Date(e.createdAt).toLocaleDateString()})]},e.id))}):(0,t.jsx)("p",{style:{color:"var(--text-secondary)"},children:"No tickets yet. Submit a ticket to get started!"})]}),i.kbArticles.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{style:{fontSize:"1.25rem",marginBottom:"1rem"},children:"Popular Articles"}),(0,t.jsx)("div",{style:{display:"grid",gap:"1rem"},children:i.kbArticles.slice(0,5).map(e=>(0,t.jsx)(a.default,{href:`/tenant/${s}/kb/${e.id}`,style:{padding:"1rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)",textDecoration:"none",color:"var(--text-primary)",display:"block"},children:e.title},e.id))})]})]})})}),(0,t.jsx)(p,{tenantId:i.id})]})}e.s(["default",()=>u],37940)}]);