module.exports=[43887,e=>{"use strict";var t=e.i(15270),i=e.i(89610),a=e.i(73421),n=e.i(29173);async function r(e){if(!e.tenantId||!e.category)return null;let i=(await t.default.tenantAssignment.findMany({where:{tenantId:e.tenantId,OR:[{category:e.category},{category:null}]},include:{user:{include:{roles:{include:{role:!0}}}}}})).map(e=>e.user).filter(e=>{let t=e.roles.map(e=>e.role.name);return t.includes("AGENT")||t.includes("IT_MANAGER")});if(0===i.length)return null;let a=await Promise.all(i.map(async e=>{let i=await t.default.ticket.count({where:{assigneeId:e.id,status:{in:[n.TicketStatus.NEW,n.TicketStatus.IN_PROGRESS]}}});return{userId:e.id,load:i}}));return a.sort((e,t)=>e.load-t.load),a[0].userId}async function u(e,n){let r=await t.default.ticket.findUnique({where:{id:e},select:{id:!0,ticketNumber:!0,subject:!0}});if(!r)throw Error("Ticket not found");return await t.default.ticket.update({where:{id:e},data:{assigneeId:n}}),await (0,i.notifyTicketAssigned)(e,r.ticketNumber,n),a.wsServer.broadcastToUser(n,"ticket:assigned",{ticket:{id:r.id,ticketNumber:r.ticketNumber,subject:r.subject}}),r}e.s(["assignTicketToAgent",()=>u,"routeTicketByCategory",()=>r])}];

//# sourceMappingURL=lib_services_ticket-routing-service_ts_1e1adca9._.js.map