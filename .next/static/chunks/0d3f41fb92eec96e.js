(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,38573,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(18566);function a(){let e=(0,s.useParams)(),a=e?.id,[i,n]=(0,r.useState)(null),[l,o]=(0,r.useState)(!0),[d,c]=(0,r.useState)(""),[m,h]=(0,r.useState)(""),[g,y]=(0,r.useState)(!1),[p,u]=(0,r.useState)(!1),[x,j]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=localStorage.getItem("user");if(e)try{j(JSON.parse(e))}catch(e){}},[]),(0,r.useEffect)(()=>{let e=async()=>{try{let e=localStorage.getItem("accessToken"),t=await fetch(`/api/v1/tickets/${a}`,{headers:e?{Authorization:`Bearer ${e}`}:{}}),r=await t.json();if(!r.success)return void c("Failed to load ticket");n(r.data)}catch(e){c("Failed to load ticket")}finally{o(!1)}};a&&e()},[a]);let v=async()=>{if(m.trim()){y(!0),c("");try{let e=localStorage.getItem("accessToken"),t=await fetch(`/api/v1/tickets/${a}`,{method:"POST",headers:{"Content-Type":"application/json",...e?{Authorization:`Bearer ${e}`}:{}},body:JSON.stringify({body:m})}),r=await t.json();if(!r.success){c(r.error?.message||"Failed to add comment"),y(!1);return}n(e=>e?{...e,comments:[...e.comments,{...r.data,author:r.data.author}]}:e),h("")}catch(e){c("Failed to add comment")}finally{y(!1)}}},f=async e=>{u(!0),c("");try{let t=localStorage.getItem("accessToken"),r=await fetch(`/api/v1/tickets/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json",...t?{Authorization:`Bearer ${t}`}:{}},body:JSON.stringify({status:e})}),s=await r.json();if(!s.success){c(s.error?.message||"Failed to update status"),u(!1);return}n(e=>e?{...e,status:s.data.status}:null)}catch(e){c("Failed to update status")}finally{u(!1)}},N=x?.roles?.some(e=>["AGENT","IT_MANAGER","ADMIN"].includes(e));return l?(0,t.jsx)("div",{className:"container",style:{padding:"2rem"},children:"Loading ticket..."}):d?(0,t.jsx)("div",{className:"container",style:{padding:"2rem",color:"var(--error)"},children:d}):i?(0,t.jsxs)("div",{className:"container",style:{padding:"2rem",display:"grid",gap:"1.5rem"},children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[(0,t.jsx)("span",{style:{fontWeight:600},children:i.ticketNumber}),(0,t.jsx)("span",{style:{color:"var(--text-secondary)"},children:new Date(i.createdAt).toLocaleString()})]}),(0,t.jsx)("h1",{style:{marginBottom:"0.5rem"},children:i.subject}),(0,t.jsx)("p",{style:{color:"var(--text-secondary)",marginBottom:"0.75rem"},children:i.description}),(0,t.jsxs)("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",marginBottom:"1rem"},children:[(0,t.jsx)("h3",{style:{marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:600},children:"Submitted By"}),(0,t.jsxs)("div",{style:{display:"grid",gap:"0.25rem",fontSize:"0.875rem"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Name:"})," ",i.requester?i.requester.firstName&&i.requester.lastName?`${i.requester.firstName} ${i.requester.lastName}`:"Not provided":i.requesterName||"Not provided"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Email:"})," ",i.requester?.email||i.requesterEmail||"Not provided"]}),i.tenant&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Tenant:"})," ",i.tenant.name]}),i.category&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Category:"})," ",i.category]})]})]}),(0,t.jsxs)("div",{style:{display:"flex",gap:"1rem",alignItems:"center",flexWrap:"wrap"},children:[(0,t.jsxs)("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[(0,t.jsx)("strong",{children:"Status:"}),N?(0,t.jsx)("select",{value:i.status,onChange:e=>f(e.target.value),disabled:p,style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid var(--border-color)",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",cursor:p?"not-allowed":"pointer"},children:["NEW","IN_PROGRESS","RESOLVED","CLOSED"].map(e=>(0,t.jsx)("option",{value:e,children:e.replace("_"," ")},e))}):(0,t.jsx)("span",{style:{color:"var(--text-secondary)"},children:i.status.replace("_"," ")})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Priority:"})," ",(0,t.jsx)("span",{style:{color:"var(--text-secondary)"},children:i.priority})]}),i.assignee&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Assigned to:"})," ",(0,t.jsx)("span",{style:{color:"var(--text-secondary)"},children:i.assignee.firstName&&i.assignee.lastName?`${i.assignee.firstName} ${i.assignee.lastName}`:i.assignee.email})]})]}),d&&(0,t.jsx)("p",{style:{color:"var(--error)",marginTop:"0.5rem"},children:d})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{style:{marginBottom:"0.75rem"},children:"Comments"}),(0,t.jsxs)("div",{style:{display:"grid",gap:"0.5rem",marginBottom:"1rem"},children:[0===i.comments.length&&(0,t.jsx)("p",{style:{color:"var(--text-secondary)"},children:"No comments yet."}),i.comments.map(e=>(0,t.jsxs)("div",{style:{border:"1px solid var(--border-color)",borderRadius:"0.5rem",padding:"0.75rem"},children:[(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.25rem"},children:[(0,t.jsx)("span",{style:{fontWeight:500},children:e.author?.email??"Unknown"}),(0,t.jsx)("span",{style:{color:"var(--text-tertiary)",fontSize:"0.85rem"},children:new Date(e.createdAt).toLocaleString()})]}),(0,t.jsx)("p",{children:e.body})]},e.id))]}),(0,t.jsxs)("div",{style:{display:"grid",gap:"0.5rem"},children:[(0,t.jsx)("textarea",{className:"input",rows:3,placeholder:"Add a comment",value:m,onChange:e=>h(e.target.value),disabled:g}),(0,t.jsx)("button",{className:"btn btn-primary",onClick:v,disabled:g,children:g?"Adding...":"Add Comment"}),d&&(0,t.jsx)("p",{style:{color:"var(--error)"},children:d})]})]})]}):null}e.s(["default",()=>a])}]);