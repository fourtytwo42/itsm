{"version":3,"sources":["../../../../app/tenant/%5Bslug%5D/page.tsx","../../../../components/TenantChatWidget.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport Link from 'next/link'\nimport TenantChatWidget from '@/components/TenantChatWidget'\n\ninterface Tenant {\n  id: string\n  name: string\n  slug: string\n  logo?: string\n  description?: string\n  requiresLogin: boolean\n  categories: string[]\n  kbArticles: Array<{\n    id: string\n    title: string\n    slug: string\n  }>\n  customFields: Array<{\n    id: string\n    label: string\n    fieldType: string\n    required: boolean\n    options?: string[]\n    placeholder?: string\n  }>\n}\n\nexport default function TenantPage() {\n  const params = useParams()\n  const router = useRouter()\n  const slug = params?.slug as string\n\n  const [tenant, setTenant] = useState<Tenant | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState('')\n  const [isAuthenticated, setIsAuthenticated] = useState(false)\n  const [tickets, setTickets] = useState<any[]>([])\n  const [loadingTickets, setLoadingTickets] = useState(false)\n  const [publicToken, setPublicToken] = useState<string | null>(null)\n\n  useEffect(() => {\n    // Check if user is authenticated\n    const token = localStorage.getItem('accessToken')\n    setIsAuthenticated(!!token)\n\n    // Get or create public token if not logged in\n    if (!token) {\n      const storedPublicToken = localStorage.getItem('publicToken')\n      if (storedPublicToken) {\n        setPublicToken(storedPublicToken)\n      } else {\n        // Generate new public token\n        generatePublicToken()\n      }\n    }\n\n    loadTenant()\n  }, [slug])\n\n  useEffect(() => {\n    // Load tickets when tenant or auth state changes\n    if (tenant) {\n      loadTickets()\n    }\n  }, [tenant, isAuthenticated, publicToken])\n\n  const generatePublicToken = async (tenantId?: string) => {\n    try {\n      const response = await fetch('/api/v1/public/token', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ tenantId: tenantId || null }),\n      })\n      const data = await response.json()\n      if (data.success) {\n        localStorage.setItem('publicToken', data.data.token)\n        localStorage.setItem('publicTokenId', data.data.publicId)\n        setPublicToken(data.data.token)\n      }\n    } catch (err) {\n      // Silently fail\n    }\n  }\n\n  useEffect(() => {\n    // Update public token with tenant ID after tenant loads\n    if (tenant && !isAuthenticated) {\n      if (!publicToken) {\n        generatePublicToken(tenant.id)\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [tenant?.id, isAuthenticated])\n\n  const loadTenant = async () => {\n    try {\n      setLoading(true)\n      const response = await fetch(`/api/v1/tenants/${slug}`)\n      const data = await response.json()\n\n      if (data.success) {\n        setTenant(data.data)\n\n        // Check if login is required\n        if (data.data.requiresLogin && !isAuthenticated) {\n          router.push(`/login?redirect=/tenant/${slug}`)\n        }\n      } else {\n        setError(data.error?.message || 'Tenant not found')\n      }\n    } catch (err) {\n      setError('Failed to load tenant')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const loadTickets = async () => {\n    try {\n      setLoadingTickets(true)\n      const token = localStorage.getItem('accessToken')\n      const publicTokenToUse = publicToken || localStorage.getItem('publicToken')\n      \n      const headers: Record<string, string> = {\n        'Content-Type': 'application/json',\n      }\n      \n      if (token) {\n        headers['Authorization'] = `Bearer ${token}`\n      } else if (publicTokenToUse) {\n        headers['Authorization'] = `Bearer ${publicTokenToUse}`\n      }\n\n      const response = await fetch(`/api/v1/tenants/${slug}/tickets`, {\n        headers,\n      })\n      const data = await response.json()\n\n      if (data.success) {\n        setTickets(data.data)\n        // Store tickets in localStorage for offline access\n        if (data.data.length > 0) {\n          localStorage.setItem(`tickets_${slug}`, JSON.stringify(data.data))\n        }\n      }\n    } catch (err) {\n      // Try to load from localStorage as fallback\n      const storedTickets = localStorage.getItem(`tickets_${slug}`)\n      if (storedTickets) {\n        try {\n          setTickets(JSON.parse(storedTickets))\n        } catch (e) {\n          // Invalid stored data\n        }\n      }\n    } finally {\n      setLoadingTickets(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\n        <p>Loading...</p>\n      </div>\n    )\n  }\n\n  if (error || !tenant) {\n    return (\n      <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\n        <div style={{ textAlign: 'center' }}>\n          <h1 style={{ fontSize: '2rem', marginBottom: '1rem' }}>Tenant Not Found</h1>\n          <p style={{ color: 'var(--text-secondary)' }}>{error || 'The tenant you are looking for does not exist.'}</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div style={{ minHeight: '100vh', backgroundColor: 'var(--bg-primary)', color: 'var(--text-primary)' }}>\n      {/* Header */}\n      <header\n        style={{\n          padding: '2rem',\n          borderBottom: '1px solid var(--border-color)',\n          backgroundColor: 'var(--bg-secondary)',\n        }}\n      >\n        <div style={{ maxWidth: '1200px', margin: '0 auto', display: 'flex', alignItems: 'center', gap: '1rem' }}>\n          {tenant.logo && (\n            <img src={tenant.logo} alt={tenant.name} style={{ width: '64px', height: '64px', borderRadius: '8px' }} />\n          )}\n          <div>\n            <h1 style={{ fontSize: '2rem', margin: 0 }}>{tenant.name}</h1>\n            {tenant.description && <p style={{ color: 'var(--text-secondary)', marginTop: '0.5rem' }}>{tenant.description}</p>}\n          </div>\n        </div>\n      </header>\n\n      {/* Navigation */}\n      <nav\n        style={{\n          padding: '1rem 2rem',\n          borderBottom: '1px solid var(--border-color)',\n          backgroundColor: 'var(--bg-secondary)',\n        }}\n      >\n        <div style={{ maxWidth: '1200px', margin: '0 auto', display: 'flex', gap: '2rem' }}>\n          <Link\n            href={`/tenant/${slug}`}\n            style={{\n              color: 'var(--accent-primary)',\n              textDecoration: 'none',\n              fontWeight: 600,\n            }}\n          >\n            Home\n          </Link>\n          <Link\n            href={`/tenant/${slug}/kb`}\n            style={{\n              color: 'var(--text-primary)',\n              textDecoration: 'none',\n            }}\n          >\n            Knowledge Base\n          </Link>\n          <Link\n            href={`/tenant/${slug}/submit`}\n            style={{\n              color: 'var(--text-primary)',\n              textDecoration: 'none',\n            }}\n          >\n            Submit Ticket\n          </Link>\n        </div>\n      </nav>\n\n      {/* Main Content */}\n      <main style={{ maxWidth: '1200px', margin: '0 auto', padding: '2rem' }}>\n        <div>\n          {/* Left Column */}\n          <div>\n            <h2 style={{ fontSize: '1.5rem', marginBottom: '1rem' }}>Welcome to {tenant.name} Support</h2>\n            <p style={{ color: 'var(--text-secondary)', marginBottom: '2rem' }}>\n              We're here to help! Browse our knowledge base or submit a support ticket.\n            </p>\n\n            {/* Quick Actions */}\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem', marginBottom: '2rem' }}>\n              <Link\n                href={`/tenant/${slug}/submit`}\n                style={{\n                  padding: '1.5rem',\n                  backgroundColor: 'var(--bg-secondary)',\n                  borderRadius: '8px',\n                  border: '1px solid var(--border-color)',\n                  textDecoration: 'none',\n                  color: 'var(--text-primary)',\n                  display: 'block',\n                }}\n              >\n                <h3 style={{ margin: 0, marginBottom: '0.5rem' }}>Submit a Ticket</h3>\n                <p style={{ margin: 0, color: 'var(--text-secondary)', fontSize: '0.875rem' }}>\n                  Get help with your issue\n                </p>\n              </Link>\n              <Link\n                href={`/tenant/${slug}/kb`}\n                style={{\n                  padding: '1.5rem',\n                  backgroundColor: 'var(--bg-secondary)',\n                  borderRadius: '8px',\n                  border: '1px solid var(--border-color)',\n                  textDecoration: 'none',\n                  color: 'var(--text-primary)',\n                  display: 'block',\n                }}\n              >\n                <h3 style={{ margin: 0, marginBottom: '0.5rem' }}>Knowledge Base</h3>\n                <p style={{ margin: 0, color: 'var(--text-secondary)', fontSize: '0.875rem' }}>\n                  Browse articles and FAQs\n                </p>\n              </Link>\n            </div>\n\n            {/* My Tickets (if logged in or has public token) */}\n            {(isAuthenticated || publicToken || localStorage.getItem('publicToken')) && (\n              <div style={{ marginBottom: '2rem' }}>\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>\n                  <h3 style={{ fontSize: '1.25rem', margin: 0 }}>My Tickets</h3>\n                  {tickets.length > 5 && (\n                    <Link\n                      href={`/tenant/${slug}/tickets`}\n                      style={{\n                        fontSize: '0.875rem',\n                        color: 'var(--accent-primary)',\n                        textDecoration: 'none',\n                      }}\n                    >\n                      View All\n                    </Link>\n                  )}\n                </div>\n                {loadingTickets ? (\n                  <p style={{ color: 'var(--text-secondary)' }}>Loading tickets...</p>\n                ) : tickets.length > 0 ? (\n                  <div style={{ display: 'grid', gap: '1rem' }}>\n                    {tickets.slice(0, 5).map((ticket) => (\n                      <Link\n                        key={ticket.id}\n                        href={`/tenant/${slug}/tickets/${ticket.id}`}\n                        style={{\n                          padding: '1rem',\n                          backgroundColor: 'var(--bg-secondary)',\n                          borderRadius: '8px',\n                          border: '1px solid var(--border-color)',\n                          textDecoration: 'none',\n                          color: 'var(--text-primary)',\n                          display: 'block',\n                        }}\n                      >\n                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem' }}>\n                          <span style={{ fontWeight: 600 }}>{ticket.ticketNumber}</span>\n                          <span\n                            style={{\n                              padding: '0.25rem 0.75rem',\n                              borderRadius: '12px',\n                              fontSize: '0.75rem',\n                              fontWeight: 600,\n                              backgroundColor:\n                                ticket.status === 'OPEN' || ticket.status === 'NEW'\n                                  ? 'rgba(59, 130, 246, 0.1)'\n                                  : ticket.status === 'RESOLVED' || ticket.status === 'CLOSED'\n                                  ? 'rgba(16, 185, 129, 0.1)'\n                                  : 'rgba(156, 163, 175, 0.1)',\n                              color:\n                                ticket.status === 'OPEN' || ticket.status === 'NEW'\n                                  ? 'rgb(59, 130, 246)'\n                                  : ticket.status === 'RESOLVED' || ticket.status === 'CLOSED'\n                                  ? 'rgb(16, 185, 129)'\n                                  : 'rgb(156, 163, 175)',\n                            }}\n                          >\n                            {ticket.status}\n                          </span>\n                        </div>\n                        <h4 style={{ margin: 0, marginBottom: '0.25rem' }}>{ticket.subject}</h4>\n                        <p style={{ margin: 0, color: 'var(--text-secondary)', fontSize: '0.875rem' }}>\n                          {new Date(ticket.createdAt).toLocaleDateString()}\n                        </p>\n                      </Link>\n                    ))}\n                  </div>\n                ) : (\n                  <p style={{ color: 'var(--text-secondary)' }}>No tickets yet. Submit a ticket to get started!</p>\n                )}\n              </div>\n            )}\n\n            {/* Recent KB Articles */}\n            {tenant.kbArticles.length > 0 && (\n              <div>\n                <h3 style={{ fontSize: '1.25rem', marginBottom: '1rem' }}>Popular Articles</h3>\n                <div style={{ display: 'grid', gap: '1rem' }}>\n                  {tenant.kbArticles.slice(0, 5).map((article) => (\n                    <Link\n                      key={article.id}\n                      href={`/tenant/${slug}/kb/${article.id}`}\n                      style={{\n                        padding: '1rem',\n                        backgroundColor: 'var(--bg-secondary)',\n                        borderRadius: '8px',\n                        border: '1px solid var(--border-color)',\n                        textDecoration: 'none',\n                        color: 'var(--text-primary)',\n                        display: 'block',\n                      }}\n                    >\n                      {article.title}\n                    </Link>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </main>\n      \n      {/* Chat Widget - Fixed position */}\n      <TenantChatWidget tenantId={tenant.id} />\n    </div>\n  )\n}\n\n","'use client'\n\nimport { useState, useRef, useEffect } from 'react'\nimport {\n  PaperAirplaneIcon,\n  XMarkIcon,\n  ArrowsPointingOutIcon,\n  ArrowsPointingInIcon,\n  TrashIcon,\n} from '@heroicons/react/24/outline'\nimport ReactMarkdown from 'react-markdown'\nimport remarkGfm from 'remark-gfm'\nimport rehypeRaw from 'rehype-raw'\n\ninterface Message {\n  role: 'user' | 'assistant'\n  content: string\n}\n\ninterface TenantChatWidgetProps {\n  tenantId: string\n}\n\nconst TENANT_CHAT_STORAGE_KEY = (tenantId: string) => `ai-chat-messages-tenant-${tenantId}`\n\nconst getInitialMessages = (tenantId: string): Message[] => {\n  if (typeof window === 'undefined') {\n    return [\n      {\n        role: 'assistant',\n        content: 'Hi! I\\'m your IT support assistant. What issue are you experiencing?',\n      },\n    ]\n  }\n\n  try {\n    const stored = localStorage.getItem(TENANT_CHAT_STORAGE_KEY(tenantId))\n    if (stored) {\n      const parsed = JSON.parse(stored)\n      if (Array.isArray(parsed) && parsed.length > 0) {\n        return parsed\n      }\n    }\n  } catch (error) {\n    console.error('Failed to load chat from localStorage:', error)\n  }\n\n  return [\n    {\n      role: 'assistant',\n      content: 'Hi! I\\'m your IT support assistant. What issue are you experiencing?',\n    },\n  ]\n}\n\nexport default function TenantChatWidget({ tenantId }: TenantChatWidgetProps) {\n  const [isOpen, setIsOpen] = useState(false)\n  const [isFullscreen, setIsFullscreen] = useState(false)\n  const [conversationId, setConversationId] = useState<string | null>(null)\n  const [messages, setMessages] = useState<Message[]>(() => getInitialMessages(tenantId))\n  const [input, setInput] = useState('')\n  const [loading, setLoading] = useState(false)\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n  const inputRef = useRef<HTMLInputElement>(null)\n  const wasInputFocusedRef = useRef(false)\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\n  }\n\n  useEffect(() => {\n    scrollToBottom()\n  }, [messages])\n\n  // Restore focus to input after receiving a message if it was previously focused\n  useEffect(() => {\n    if (!loading && wasInputFocusedRef.current && inputRef.current) {\n      // Small delay to ensure DOM has updated\n      setTimeout(() => {\n        inputRef.current?.focus()\n      }, 100)\n    }\n  }, [messages, loading])\n\n  // Save messages to localStorage whenever they change (but skip if we just cleared)\n  const skipSaveRef = useRef(false)\n  useEffect(() => {\n    if (skipSaveRef.current) {\n      skipSaveRef.current = false\n      return\n    }\n    if (typeof window !== 'undefined' && messages.length > 0) {\n      try {\n        localStorage.setItem(TENANT_CHAT_STORAGE_KEY(tenantId), JSON.stringify(messages))\n      } catch (error) {\n        console.error('Failed to save chat to localStorage:', error)\n      }\n    }\n  }, [messages, tenantId])\n\n  const handleSend = async () => {\n    if (!input.trim() || loading) {\n      console.log('[TenantChatWidget] handleSend: Skipping - input empty or already loading', { input: input.trim(), loading, tenantId })\n      return\n    }\n\n    const userMessage: Message = { role: 'user', content: input }\n    const userInputText = input\n    const newMessages = [...messages, userMessage]\n    \n    console.log('[TenantChatWidget] handleSend: Starting', { \n      messageCount: newMessages.length, \n      userMessage: userInputText.substring(0, 50),\n      tenantId \n    })\n    \n    setMessages(newMessages)\n    setInput('')\n    setLoading(true)\n\n    try {\n      const token = localStorage.getItem('accessToken')\n      const requestBody = {\n        messages: newMessages.map((m) => ({\n          role: m.role,\n          content: m.content,\n        })),\n        tenantId,\n      }\n      \n      console.log('[TenantChatWidget] handleSend: Sending request', { \n        messageCount: requestBody.messages.length,\n        hasToken: !!token,\n        tenantId \n      })\n      \n      // Add timeout to prevent hanging requests\n      const controller = new AbortController()\n      const timeoutId = setTimeout(() => {\n        console.error('[TenantChatWidget] handleSend: Request timeout after 60s', { tenantId })\n        controller.abort()\n      }, 60000) // 60 second timeout\n      \n      let response: Response\n      try {\n        response = await fetch('/api/v1/ai/chat', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            ...(token && { Authorization: `Bearer ${token}` }),\n          },\n          body: JSON.stringify(requestBody),\n          signal: controller.signal,\n        })\n        clearTimeout(timeoutId)\n      } catch (fetchError) {\n        clearTimeout(timeoutId)\n        if (fetchError instanceof Error && fetchError.name === 'AbortError') {\n          throw new Error('Request timeout - the server took too long to respond. Please try again.')\n        }\n        throw fetchError\n      }\n\n      console.log('[TenantChatWidget] handleSend: Response received', { \n        status: response.status, \n        ok: response.ok,\n        tenantId \n      })\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        console.error('[TenantChatWidget] handleSend: HTTP Error', { \n          status: response.status, \n          statusText: response.statusText,\n          errorText: errorText.substring(0, 200),\n          tenantId \n        })\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`)\n      }\n\n      const data = await response.json()\n      console.log('[TenantChatWidget] handleSend: Response parsed', { \n        success: data.success,\n        hasReply: !!data.data?.reply,\n        replyLength: data.data?.reply?.length || 0,\n        tenantId \n      })\n\n      if (!data.success) {\n        console.error('[TenantChatWidget] handleSend: API Error Response', { \n          error: data.error,\n          errorCode: data.error?.code,\n          errorMessage: data.error?.message,\n          tenantId \n        })\n        throw new Error(data.error?.message || 'Failed to get response')\n      }\n\n      if (!data.data?.reply) {\n        console.error('[TenantChatWidget] handleSend: No reply in response', { data, tenantId })\n        throw new Error('No reply received from server')\n      }\n\n      // Store conversationId but don't use it for loading history\n      // We use localStorage for persistence, conversationId is just for backend tracking\n      if (data.data.conversationId) {\n        console.log('[TenantChatWidget] handleSend: Conversation ID updated', { \n          conversationId: data.data.conversationId,\n          tenantId \n        })\n        setConversationId(data.data.conversationId)\n      }\n\n      const assistantMessage: Message = {\n        role: 'assistant',\n        content: data.data.reply,\n      }\n\n      console.log('[TenantChatWidget] handleSend: Adding assistant message', { \n        messageLength: assistantMessage.content.length,\n        tenantId \n      })\n      \n      setMessages((prev) => {\n        const updated = [...prev, assistantMessage]\n        console.log('[TenantChatWidget] handleSend: Messages updated', { \n          totalMessages: updated.length,\n          tenantId \n        })\n        return updated\n      })\n    } catch (error) {\n      console.error('[TenantChatWidget] handleSend: Exception caught', { \n        error,\n        errorMessage: error instanceof Error ? error.message : String(error),\n        errorStack: error instanceof Error ? error.stack : undefined,\n        tenantId \n      })\n      \n      const errorMessage: Message = {\n        role: 'assistant',\n        content: `Sorry, I encountered an error. Please try again or create a support ticket. Error: ${error instanceof Error ? error.message : 'Unknown error'}`,\n      }\n      \n      setMessages((prev) => [...prev, errorMessage])\n    } finally {\n      console.log('[TenantChatWidget] handleSend: Finalizing (setting loading to false)', { tenantId })\n      setLoading(false)\n    }\n  }\n\n  const handleClearChat = () => {\n    // Skip saving when clearing\n    skipSaveRef.current = true\n    \n    // Clear localStorage first\n    if (typeof window !== 'undefined') {\n      try {\n        localStorage.removeItem(TENANT_CHAT_STORAGE_KEY(tenantId))\n      } catch (error) {\n        console.error('Failed to clear chat from localStorage:', error)\n      }\n    }\n\n    // Reset conversation ID\n    setConversationId(null)\n\n    // Reset messages to initial state immediately\n    const initialMessages = [\n      {\n        role: 'assistant' as const,\n        content: 'Hi! I\\'m your IT support assistant. What issue are you experiencing?',\n      },\n    ]\n    setMessages(initialMessages)\n    \n    // Now save the cleared state\n    if (typeof window !== 'undefined') {\n      try {\n        localStorage.setItem(TENANT_CHAT_STORAGE_KEY(tenantId), JSON.stringify(initialMessages))\n      } catch (error) {\n        console.error('Failed to save cleared chat to localStorage:', error)\n      }\n    }\n  }\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault()\n      handleSend()\n    }\n  }\n\n  const toggleFullscreen = () => {\n    setIsFullscreen(!isFullscreen)\n  }\n\n  if (!isOpen) {\n    return (\n      <button\n        onClick={() => setIsOpen(true)}\n        style={{\n          position: 'fixed',\n          bottom: '2rem',\n          right: '2rem',\n          width: '60px',\n          height: '60px',\n          borderRadius: '50%',\n          backgroundColor: 'var(--accent-primary)',\n          color: 'white',\n          border: 'none',\n          cursor: 'pointer',\n          boxShadow: '0 4px 12px var(--shadow)',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          zIndex: 1000,\n        }}\n        aria-label=\"Open chat\"\n      >\n        <PaperAirplaneIcon style={{ width: '24px', height: '24px' }} />\n      </button>\n    )\n  }\n\n  const widgetStyle: React.CSSProperties = isFullscreen\n    ? {\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        width: '100vw',\n        height: '100vh',\n        backgroundColor: 'var(--bg-secondary)',\n        border: 'none',\n        borderRadius: 0,\n        boxShadow: 'none',\n        display: 'flex',\n        flexDirection: 'column',\n        zIndex: 9999,\n      }\n    : {\n        position: 'fixed',\n        bottom: '2rem',\n        right: '2rem',\n        width: '600px',\n        maxWidth: 'calc(100vw - 40px)',\n        height: '800px',\n        maxHeight: 'calc(100vh - 40px)',\n        backgroundColor: 'var(--bg-secondary)',\n        border: '1px solid var(--border-color)',\n        borderRadius: '12px',\n        boxShadow: '0 8px 24px var(--shadow)',\n        display: 'flex',\n        flexDirection: 'column',\n        zIndex: 1000,\n      }\n\n  return (\n    <div style={widgetStyle}>\n      <div\n        style={{\n          padding: '0.75rem',\n          borderBottom: '1px solid var(--border-color)',\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n        }}\n      >\n        <h3 style={{ margin: 0, fontWeight: '600', fontSize: '0.875rem' }}>AI Assistant</h3>\n        <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>\n          <button\n            onClick={handleClearChat}\n            style={{\n              background: 'none',\n              border: 'none',\n              color: 'var(--text-secondary)',\n              cursor: 'pointer',\n              padding: '0.25rem',\n              display: 'flex',\n              alignItems: 'center',\n            }}\n            aria-label=\"Clear chat\"\n            title=\"Clear chat\"\n          >\n            <TrashIcon style={{ width: '20px', height: '20px' }} />\n          </button>\n          <button\n            onClick={toggleFullscreen}\n            style={{\n              background: 'none',\n              border: 'none',\n              color: 'var(--text-secondary)',\n              cursor: 'pointer',\n              padding: '0.25rem',\n              display: 'flex',\n              alignItems: 'center',\n            }}\n            aria-label={isFullscreen ? 'Exit fullscreen' : 'Enter fullscreen'}\n            title={isFullscreen ? 'Exit fullscreen' : 'Enter fullscreen'}\n          >\n            {isFullscreen ? (\n              <ArrowsPointingInIcon style={{ width: '20px', height: '20px' }} />\n            ) : (\n              <ArrowsPointingOutIcon style={{ width: '20px', height: '20px' }} />\n            )}\n          </button>\n          <button\n            onClick={() => setIsOpen(false)}\n            style={{\n              background: 'none',\n              border: 'none',\n              color: 'var(--text-secondary)',\n              cursor: 'pointer',\n              padding: '0.25rem',\n            }}\n            aria-label=\"Close chat\"\n          >\n            <XMarkIcon style={{ width: '20px', height: '20px' }} />\n          </button>\n        </div>\n      </div>\n\n      <div\n        style={{\n          flex: 1,\n          overflowY: 'auto',\n          padding: '0.75rem',\n          display: 'flex',\n          flexDirection: 'column',\n          gap: '0.75rem',\n        }}\n      >\n        {messages.map((msg, idx) => (\n            <div\n              key={idx}\n              style={{\n                alignSelf: msg.role === 'user' ? 'flex-end' : 'flex-start',\n                maxWidth: '80%',\n                padding: '0.5rem 0.75rem',\n                borderRadius: '12px',\n                backgroundColor: msg.role === 'user' ? 'var(--accent-primary)' : 'var(--bg-tertiary)',\n                color: msg.role === 'user' ? 'white' : 'var(--text-primary)',\n                wordWrap: 'break-word',\n                overflowWrap: 'break-word',\n                whiteSpace: 'pre-wrap',\n                fontSize: '0.8125rem',\n                lineHeight: 1.5,\n              }}\n            >\n              {msg.role === 'assistant' ? (\n                <div\n                  style={{\n                    // Style for markdown content\n                    lineHeight: 1.4,\n                    fontSize: '0.8125rem',\n                  }}\n                >\n                  <ReactMarkdown\n                    remarkPlugins={[remarkGfm]}\n                    rehypePlugins={[rehypeRaw]}\n                    components={{\n                      p: ({ children }: any) => <p style={{ margin: '0 0 0.375rem 0', fontSize: '0.8125rem' }}>{children}</p>,\n                      ul: ({ children }: any) => (\n                        <ul style={{ margin: '0 0 0.5rem 0', paddingLeft: '1.5rem' }}>{children}</ul>\n                      ),\n                      ol: ({ children }: any) => (\n                        <ol style={{ margin: '0 0 0.5rem 0', paddingLeft: '1.5rem' }}>{children}</ol>\n                      ),\n                      li: ({ children }: any) => <li style={{ margin: '0.25rem 0' }}>{children}</li>,\n                      code: ({ children, className }: any) => (\n                        <code\n                          style={{\n                            backgroundColor: 'rgba(0,0,0,0.1)',\n                            padding: '0.15rem 0.3rem',\n                            borderRadius: '4px',\n                            fontSize: '0.75em',\n                            fontFamily: 'monospace',\n                          }}\n                        >\n                          {children}\n                        </code>\n                      ),\n                      pre: ({ children }: any) => (\n                        <pre\n                          style={{\n                            backgroundColor: 'rgba(0,0,0,0.1)',\n                            padding: '0.5rem',\n                            borderRadius: '8px',\n                            overflowX: 'auto',\n                            margin: '0.375rem 0',\n                            fontSize: '0.75em',\n                            fontFamily: 'monospace',\n                          }}\n                        >\n                          {children}\n                        </pre>\n                      ),\n                      a: ({ children, href }: any) => (\n                        <a\n                          href={href}\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                          style={{\n                            color: 'inherit',\n                            textDecoration: 'underline',\n                          }}\n                        >\n                          {children}\n                        </a>\n                      ),\n                      strong: ({ children }: any) => <strong style={{ fontWeight: 600 }}>{children}</strong>,\n                      em: ({ children }: any) => <em style={{ fontStyle: 'italic' }}>{children}</em>,\n                    }}\n                  >\n                    {msg.content}\n                  </ReactMarkdown>\n                </div>\n              ) : (\n                <div style={{ fontSize: '0.8125rem' }}>{msg.content}</div>\n              )}\n            </div>\n          ))}\n        {loading && (\n          <div\n            style={{\n              alignSelf: 'flex-start',\n              padding: '0.5rem 0.75rem',\n              borderRadius: '12px',\n              backgroundColor: 'var(--bg-tertiary)',\n              color: 'var(--text-secondary)',\n              fontSize: '0.8125rem',\n            }}\n          >\n            Thinking...\n          </div>\n        )}\n        <div ref={messagesEndRef} />\n      </div>\n\n      <div\n        style={{\n          padding: '0.75rem',\n          borderTop: '1px solid var(--border-color)',\n          display: 'flex',\n          gap: '0.5rem',\n        }}\n      >\n        <input\n          ref={inputRef}\n          type=\"text\"\n          value={input}\n          onChange={(e) => setInput(e.target.value)}\n          onKeyPress={handleKeyPress}\n          onFocus={() => {\n            wasInputFocusedRef.current = true\n          }}\n          onBlur={() => {\n            // Only clear the flag if user explicitly clicks away\n            // We'll check document.activeElement to see if focus moved elsewhere intentionally\n            setTimeout(() => {\n              if (document.activeElement !== inputRef.current) {\n                wasInputFocusedRef.current = false\n              }\n            }, 100)\n          }}\n          placeholder=\"Type your message...\"\n          disabled={loading}\n          style={{\n            flex: 1,\n            padding: '0.5rem 0.75rem',\n            border: '1px solid var(--border-color)',\n            borderRadius: '8px',\n            backgroundColor: 'var(--bg-primary)',\n            color: 'var(--text-primary)',\n            fontSize: '0.75rem',\n          }}\n        />\n        <button\n          onClick={handleSend}\n          disabled={loading || !input.trim()}\n          style={{\n            padding: '0.5rem 0.75rem',\n            backgroundColor: 'var(--accent-primary)',\n            color: 'white',\n            border: 'none',\n            borderRadius: '8px',\n            cursor: loading || !input.trim() ? 'not-allowed' : 'pointer',\n            opacity: loading || !input.trim() ? 0.5 : 1,\n          }}\n        >\n          <PaperAirplaneIcon style={{ width: '20px', height: '20px' }} />\n        </button>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}