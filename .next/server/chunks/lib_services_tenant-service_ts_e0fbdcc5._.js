module.exports=[16766,e=>{"use strict";var t=e.i(15270);async function n(e){if(!/^[a-z0-9-]+$/.test(e.slug))throw Error("Slug must contain only lowercase letters, numbers, and hyphens");if(await t.default.tenant.findUnique({where:{slug:e.slug}}))throw Error("Tenant with this slug already exists");return t.default.tenant.create({data:{name:e.name,slug:e.slug,description:e.description,logo:e.logo,requiresLogin:e.requiresLogin??!1,isActive:e.isActive??!0,organizationId:e.organizationId},include:{categories:!0,kbArticles:{include:{article:{select:{id:!0,title:!0,slug:!0}}}},customFields:{orderBy:{order:"asc"}},assignments:{include:{user:{select:{id:!0,email:!0,firstName:!0,lastName:!0}}}}}})}async function a(e,n){if(n.slug){if(!/^[a-z0-9-]+$/.test(n.slug))throw Error("Slug must contain only lowercase letters, numbers, and hyphens");let a=await t.default.tenant.findUnique({where:{slug:n.slug}});if(a&&a.id!==e)throw Error("Tenant with this slug already exists")}return t.default.tenant.update({where:{id:e},data:{name:n.name,slug:n.slug,description:n.description,logo:n.logo,requiresLogin:n.requiresLogin,isActive:n.isActive},include:{categories:!0,kbArticles:{include:{article:{select:{id:!0,title:!0,slug:!0}}}},customFields:{orderBy:{order:"asc"}},assignments:{include:{user:{select:{id:!0,email:!0,firstName:!0,lastName:!0}}}}}})}async function i(e){return t.default.tenant.findUnique({where:{slug:e,isActive:!0},include:{organization:{select:{id:!0,name:!0,slug:!0,logo:!0}},categories:!0,kbArticles:{include:{article:{select:{id:!0,title:!0,slug:!0,content:!0,tags:!0}}}},customFields:{orderBy:{order:"asc"}}}})}async function r(e){return t.default.tenant.findUnique({where:{id:e},include:{categories:!0,kbArticles:{include:{article:{select:{id:!0,title:!0,slug:!0}}}},customFields:{orderBy:{order:"asc"}},assignments:{include:{user:{select:{id:!0,email:!0,firstName:!0,lastName:!0}}}}}})}async function s(e){let n={};if(e?.search&&(n.OR=[{name:{contains:e.search,mode:"insensitive"}},{slug:{contains:e.search,mode:"insensitive"}},{description:{contains:e.search,mode:"insensitive"}}]),e?.isActive!==void 0&&(n.isActive=e.isActive),e?.userId&&e?.userRoles&&!e.userRoles.includes("GLOBAL_ADMIN")){let a=await t.default.user.findUnique({where:{id:e.userId},select:{organizationId:!0}});if(!a?.organizationId)return[];n.organizationId=a.organizationId}return e?.organizationId&&(n.organizationId=e.organizationId),t.default.tenant.findMany({where:n,orderBy:{createdAt:"desc"},include:{categories:!0,organization:{select:{id:!0,name:!0,slug:!0}},_count:{select:{tickets:!0,assignments:!0}}}})}async function l(e){return t.default.tenant.update({where:{id:e},data:{isActive:!1}})}async function d(e,n){return await t.default.tenantCategory.deleteMany({where:{tenantId:e}}),n.length>0&&await t.default.tenantCategory.createMany({data:n.map(t=>({tenantId:e,category:t}))}),t.default.tenantCategory.findMany({where:{tenantId:e}})}async function u(e,n){return await t.default.tenantKBArticle.deleteMany({where:{tenantId:e}}),n.length>0&&await t.default.tenantKBArticle.createMany({data:n.map(t=>({tenantId:e,articleId:t}))}),t.default.tenantKBArticle.findMany({where:{tenantId:e},include:{article:{select:{id:!0,title:!0,slug:!0}}}})}async function o(e){return t.default.tenantCustomField.create({data:{tenantId:e.tenantId,label:e.label,fieldType:e.fieldType,required:e.required??!1,options:e.options??[],placeholder:e.placeholder,order:e.order??0}})}async function c(e,n){return t.default.tenantCustomField.update({where:{id:e},data:{label:n.label,fieldType:n.fieldType,required:n.required,options:n.options,placeholder:n.placeholder,order:n.order}})}async function g(e){return t.default.tenantCustomField.delete({where:{id:e}})}async function f(e){return t.default.tenantAssignment.create({data:{tenantId:e.tenantId,userId:e.userId,category:e.category},include:{user:{select:{id:!0,email:!0,firstName:!0,lastName:!0}},tenant:{select:{id:!0,name:!0,slug:!0}}}})}async function m(e){return t.default.tenantAssignment.delete({where:{id:e}})}async function y(e){return t.default.tenantAssignment.findMany({where:{userId:e},include:{tenant:{select:{id:!0,name:!0,slug:!0}}}})}async function h(e){let n=await t.default.tenantAssignment.findMany({where:{userId:e},include:{tenant:{select:{id:!0,name:!0}}}}),a=new Map;for(let e of n){let n=e.tenantId;a.has(n)||a.set(n,new Set),null===e.category?(await t.default.tenantCategory.findMany({where:{tenantId:n}})).forEach(e=>{a.get(n).add(e.category)}):a.get(n).add(e.category)}return a}async function w(e,n){let a=await t.default.user.findUnique({where:{id:e},include:{roles:{include:{role:!0}}}});if(!a)return!1;if(a.roles.some(e=>"GLOBAL_ADMIN"===e.role.name))return!0;let i=await t.default.tenant.findUnique({where:{id:n},select:{organizationId:!0}});return!!i&&a.organizationId===i.organizationId}e.s(["canManageTenant",()=>w,"createAssignment",()=>f,"createCustomField",()=>o,"createTenant",()=>n,"deleteAssignment",()=>m,"deleteCustomField",()=>g,"deleteTenant",()=>l,"getTenantById",()=>r,"getTenantBySlug",()=>i,"getUserAssignedCategories",()=>h,"getUserTenantAssignments",()=>y,"listTenants",()=>s,"manageTenantCategories",()=>d,"manageTenantKBArticles",()=>u,"updateCustomField",()=>c,"updateTenant",()=>a])}];

//# sourceMappingURL=lib_services_tenant-service_ts_e0fbdcc5._.js.map