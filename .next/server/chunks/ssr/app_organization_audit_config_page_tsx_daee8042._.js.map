{"version":3,"sources":["../../../../app/organization/audit/config/page.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useState, Suspense } from 'react'\nimport { useSearchParams } from 'next/navigation'\n\nconst AUDIT_EVENT_TYPES = [\n  'USER_CREATED',\n  'USER_UPDATED',\n  'USER_DELETED',\n  'USER_ACTIVATED',\n  'USER_DEACTIVATED',\n  'USER_PASSWORD_RESET',\n  'USER_ROLE_CHANGED',\n  'ORGANIZATION_CREATED',\n  'ORGANIZATION_UPDATED',\n  'ORGANIZATION_DELETED',\n  'TENANT_CREATED',\n  'TENANT_UPDATED',\n  'TENANT_DELETED',\n  'TENANT_USER_ASSIGNED',\n  'TENANT_USER_UNASSIGNED',\n  'TICKET_CREATED',\n  'TICKET_UPDATED',\n  'TICKET_DELETED',\n  'TICKET_ASSIGNED',\n  'TICKET_STATUS_CHANGED',\n  'TICKET_PRIORITY_CHANGED',\n  'TICKET_COMMENT_ADDED',\n  'KB_ARTICLE_CREATED',\n  'KB_ARTICLE_UPDATED',\n  'KB_ARTICLE_DELETED',\n  'ASSET_CREATED',\n  'ASSET_UPDATED',\n  'ASSET_DELETED',\n  'ASSET_ASSIGNED',\n  'CHANGE_CREATED',\n  'CHANGE_UPDATED',\n  'CHANGE_DELETED',\n  'CHANGE_APPROVED',\n  'CHANGE_REJECTED',\n  'PERMISSION_GRANTED',\n  'PERMISSION_REVOKED',\n]\n\ninterface AuditConfig {\n  id: string\n  organizationId: string\n  enabled: boolean\n  events: string[]\n  retentionDays?: number\n}\n\nfunction AuditConfigPageContent() {\n  const searchParams = useSearchParams()\n  const organizationId = searchParams.get('organizationId')\n\n  const [config, setConfig] = useState<AuditConfig | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [error, setError] = useState('')\n  const [success, setSuccess] = useState('')\n\n  useEffect(() => {\n    fetchConfig()\n  }, [organizationId])\n\n  const fetchConfig = async () => {\n    try {\n      const token = localStorage.getItem('accessToken')\n      const params = new URLSearchParams()\n      if (organizationId) {\n        params.append('organizationId', organizationId)\n      }\n\n      const response = await fetch(`/api/v1/organizations/audit/config?${params.toString()}`, {\n        headers: {\n          Authorization: `Bearer ${token}`,\n        },\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to fetch audit config')\n      }\n\n      const data = await response.json()\n      setConfig(data)\n    } catch (err: any) {\n      setError(err.message)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleToggleEvent = (eventType: string) => {\n    if (!config) return\n\n    const events = config.events.includes(eventType)\n      ? config.events.filter((e) => e !== eventType)\n      : [...config.events, eventType]\n\n    setConfig({ ...config, events })\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    if (!config) return\n\n    setSaving(true)\n    setError('')\n    setSuccess('')\n\n    try {\n      const token = localStorage.getItem('accessToken')\n      const response = await fetch('/api/v1/organizations/audit/config', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`,\n        },\n        body: JSON.stringify({\n          organizationId: organizationId || config.organizationId,\n          enabled: config.enabled,\n          events: config.events,\n          retentionDays: config.retentionDays || null,\n        }),\n      })\n\n      const data = await response.json()\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Failed to update audit config')\n      }\n\n      setSuccess('Audit configuration updated successfully')\n      setConfig(data)\n    } catch (err: any) {\n      setError(err.message)\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  if (loading) {\n    return <div>Loading audit configuration...</div>\n  }\n\n  if (!config) {\n    return <div>Audit configuration not found</div>\n  }\n\n  return (\n    <div style={{ padding: '2rem', maxWidth: '1000px', margin: '0 auto' }}>\n      <h1 style={{ marginBottom: '2rem' }}>Audit Configuration</h1>\n\n      {error && (\n        <div\n          style={{\n            padding: '0.75rem',\n            backgroundColor: 'rgba(239, 68, 68, 0.1)',\n            border: '1px solid var(--error)',\n            borderRadius: '0.5rem',\n            marginBottom: '1rem',\n            color: 'var(--error)',\n          }}\n        >\n          {error}\n        </div>\n      )}\n\n      {success && (\n        <div\n          style={{\n            padding: '0.75rem',\n            backgroundColor: 'rgba(34, 197, 94, 0.1)',\n            border: '1px solid var(--success)',\n            borderRadius: '0.5rem',\n            marginBottom: '1rem',\n            color: 'var(--success)',\n          }}\n        >\n          {success}\n        </div>\n      )}\n\n      <div className=\"card\" style={{ padding: '2rem' }}>\n        <form onSubmit={handleSubmit}>\n          <div style={{ marginBottom: '1.5rem' }}>\n            <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n              <input\n                type=\"checkbox\"\n                checked={config.enabled}\n                onChange={(e) => setConfig({ ...config, enabled: e.target.checked })}\n                disabled={saving}\n              />\n              <span>Enable Audit Logging</span>\n            </label>\n          </div>\n\n          <div style={{ marginBottom: '1.5rem' }}>\n            <label className=\"label\" htmlFor=\"retentionDays\">\n              Retention Days (leave empty for forever)\n            </label>\n            <input\n              id=\"retentionDays\"\n              type=\"number\"\n              className=\"input\"\n              value={config.retentionDays || ''}\n              onChange={(e) =>\n                setConfig({\n                  ...config,\n                  retentionDays: e.target.value ? parseInt(e.target.value) : undefined,\n                })\n              }\n              min=\"1\"\n              disabled={saving}\n            />\n          </div>\n\n          <div style={{ marginBottom: '1.5rem' }}>\n            <h3 style={{ marginBottom: '1rem' }}>Events to Track</h3>\n            <div\n              style={{\n                display: 'grid',\n                gridTemplateColumns: 'repeat(auto-fill, minmax(250px, 1fr))',\n                gap: '0.5rem',\n                maxHeight: '400px',\n                overflowY: 'auto',\n                padding: '1rem',\n                backgroundColor: 'var(--bg-secondary)',\n                borderRadius: '0.5rem',\n              }}\n            >\n              {AUDIT_EVENT_TYPES.map((eventType) => (\n                <label\n                  key={eventType}\n                  style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', cursor: 'pointer' }}\n                >\n                  <input\n                    type=\"checkbox\"\n                    checked={config.events.includes(eventType)}\n                    onChange={() => handleToggleEvent(eventType)}\n                    disabled={saving || !config.enabled}\n                  />\n                  <span style={{ fontSize: '0.875rem' }}>{eventType}</span>\n                </label>\n              ))}\n            </div>\n          </div>\n\n          <button type=\"submit\" className=\"btn btn-primary\" disabled={saving}>\n            {saving ? 'Saving...' : 'Save Configuration'}\n          </button>\n        </form>\n      </div>\n    </div>\n  )\n}\n\nexport default function AuditConfigPage() {\n  return (\n    <Suspense fallback={<div>Loading audit configuration...</div>}>\n      <AuditConfigPageContent />\n    </Suspense>\n  )\n}\n\n"],"names":[],"mappings":"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"}