(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,46747,e=>{"use strict";var r=e.i(43476),t=e.i(71645),a=e.i(18566),s=e.i(22016);function i(){let e=(0,a.useParams)(),[i,o]=(0,t.useState)(null),[n,d]=(0,t.useState)(!0),[l,c]=(0,t.useState)(!1);(0,t.useEffect)(()=>{e.id&&p(e.id)},[e.id]);let p=async e=>{try{d(!0);let r=localStorage.getItem("accessToken"),t=await fetch(`/api/v1/changes/${e}`,{headers:r?{Authorization:`Bearer ${r}`}:{}}),a=await t.json();a.success&&o(a.data.changeRequest)}catch(e){console.error("Failed to load change request:",e)}finally{d(!1)}},m=async()=>{try{let r=localStorage.getItem("accessToken"),t=await fetch(`/api/v1/changes/${e.id}/submit`,{method:"POST",headers:r?{Authorization:`Bearer ${r}`}:{}});(await t.json()).success&&await p(e.id)}catch(e){console.error("Failed to submit change request:",e)}},h=async(r,t,a)=>{try{c(!0);let s=localStorage.getItem("accessToken"),i=await fetch("/api/v1/auth/me",{headers:s?{Authorization:`Bearer ${s}`}:{}}),o=await i.json(),n=await fetch(`/api/v1/changes/${e.id}/approve`,{method:"POST",headers:{"Content-Type":"application/json",...s&&{Authorization:`Bearer ${s}`}},body:JSON.stringify({approverId:o.data?.user?.id||"",stage:r,approved:t,comments:a})});(await n.json()).success&&await p(e.id)}catch(e){console.error("Failed to approve change request:",e)}finally{c(!1)}};return n?(0,r.jsx)("div",{style:{padding:"2rem"},children:"Loading change request..."}):i?(0,r.jsxs)("div",{style:{padding:"2rem",maxWidth:"1200px",margin:"0 auto"},children:[(0,r.jsx)("div",{style:{marginBottom:"2rem"},children:(0,r.jsx)(s.default,{href:"/changes",style:{color:"var(--accent-primary)",textDecoration:"none"},children:"â† Back to Changes"})}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"2rem"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{style:{marginBottom:"0.5rem"},children:i.title}),(0,r.jsx)("p",{style:{color:"var(--text-secondary)",margin:0},children:i.changeNumber})]}),"DRAFT"===i.status&&(0,r.jsx)("button",{onClick:m,style:{padding:"0.5rem 1rem",backgroundColor:"var(--accent-primary)",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Submit for Approval"})]}),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2rem",marginBottom:"2rem"},children:[(0,r.jsxs)("div",{style:{padding:"1.5rem",border:"1px solid var(--border-color)",borderRadius:"8px",backgroundColor:"var(--bg-secondary)"},children:[(0,r.jsx)("h2",{style:{marginTop:0,marginBottom:"1rem"},children:"Details"}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Status:"})," ",i.status]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Type:"})," ",i.type]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Priority:"})," ",i.priority]}),i.riskLevel&&(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Risk Level:"})," ",i.riskLevel]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Requester:"})," ",`${i.requester.firstName||""} ${i.requester.lastName||""}`.trim()||i.requester.email]}),i.relatedTicket&&(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Related Ticket:"})," ",(0,r.jsxs)(s.default,{href:`/tickets/${i.relatedTicket.id}`,style:{color:"var(--accent-primary)"},children:[i.relatedTicket.ticketNumber," - ",i.relatedTicket.subject]})]})]})]}),(0,r.jsxs)("div",{style:{padding:"1.5rem",border:"1px solid var(--border-color)",borderRadius:"8px",backgroundColor:"var(--bg-secondary)"},children:[(0,r.jsx)("h2",{style:{marginTop:0,marginBottom:"1rem"},children:"Timeline"}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[i.plannedStartDate&&(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Planned Start:"})," ",new Date(i.plannedStartDate).toLocaleDateString()]}),i.plannedEndDate&&(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Planned End:"})," ",new Date(i.plannedEndDate).toLocaleDateString()]}),i.actualStartDate&&(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Actual Start:"})," ",new Date(i.actualStartDate).toLocaleDateString()]}),i.actualEndDate&&(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Actual End:"})," ",new Date(i.actualEndDate).toLocaleDateString()]})]})]})]}),(0,r.jsxs)("div",{style:{padding:"1.5rem",border:"1px solid var(--border-color)",borderRadius:"8px",backgroundColor:"var(--bg-secondary)",marginBottom:"2rem"},children:[(0,r.jsx)("h2",{style:{marginTop:0,marginBottom:"1rem"},children:"Description"}),(0,r.jsx)("p",{style:{whiteSpace:"pre-wrap"},children:i.description})]}),i.approvals&&i.approvals.length>0&&(0,r.jsxs)("div",{style:{padding:"1.5rem",border:"1px solid var(--border-color)",borderRadius:"8px",backgroundColor:"var(--bg-secondary)",marginBottom:"2rem"},children:[(0,r.jsx)("h2",{style:{marginTop:0,marginBottom:"1rem"},children:"Approvals"}),(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:i.approvals.map(e=>(0,r.jsxs)("div",{style:{padding:"1rem",border:"1px solid var(--border-color)",borderRadius:"6px"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"0.5rem"},children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("strong",{children:["Stage ",e.stage,":"]})," ",e.approver.firstName||""," ",e.approver.lastName||""," (",e.approver.email,")"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Status:"})," ",e.status]})]}),e.comments&&(0,r.jsxs)("div",{style:{marginTop:"0.5rem",color:"var(--text-secondary)"},children:[(0,r.jsx)("strong",{children:"Comments:"})," ",e.comments]}),"PENDING"===e.status&&"IN_REVIEW"===i.status&&(0,r.jsxs)("div",{style:{marginTop:"1rem",display:"flex",gap:"0.5rem"},children:[(0,r.jsx)("button",{onClick:()=>{let r=prompt("Enter approval comments (optional):");h(e.stage,!0,r||void 0)},disabled:l,style:{padding:"0.5rem 1rem",backgroundColor:"green",color:"white",border:"none",borderRadius:"6px",cursor:l?"not-allowed":"pointer"},children:"Approve"}),(0,r.jsx)("button",{onClick:()=>{let r=prompt("Enter rejection comments (optional):");h(e.stage,!1,r||void 0)},disabled:l,style:{padding:"0.5rem 1rem",backgroundColor:"red",color:"white",border:"none",borderRadius:"6px",cursor:l?"not-allowed":"pointer"},children:"Reject"})]})]},e.id))})]}),i.implementationNotes&&(0,r.jsxs)("div",{style:{padding:"1.5rem",border:"1px solid var(--border-color)",borderRadius:"8px",backgroundColor:"var(--bg-secondary)"},children:[(0,r.jsx)("h2",{style:{marginTop:0,marginBottom:"1rem"},children:"Implementation Notes"}),(0,r.jsx)("p",{style:{whiteSpace:"pre-wrap"},children:i.implementationNotes})]})]}):(0,r.jsxs)("div",{style:{padding:"2rem"},children:[(0,r.jsx)("p",{children:"Change request not found"}),(0,r.jsx)(s.default,{href:"/changes",children:"Back to Changes"})]})}e.s(["default",()=>i])}]);