(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,66861,e=>{"use strict";var r=e.i(18050),t=e.i(71645),a=e.i(18566),s=e.i(22016);function i(){let e=(0,a.useParams)();(0,a.useRouter)();let i=e?.slug,o=e?.id,[n,l]=(0,t.useState)(null),[d,c]=(0,t.useState)(!0),[m,g]=(0,t.useState)(""),[y,u]=(0,t.useState)(""),[h,p]=(0,t.useState)(!1),[x,b]=(0,t.useState)(!1),[v,f]=(0,t.useState)(null),[j,S]=(0,t.useState)(!1);(0,t.useEffect)(()=>{let e=localStorage.getItem("user");if(S(!!localStorage.getItem("accessToken")),e)try{f(JSON.parse(e))}catch(e){}},[]),(0,t.useEffect)(()=>{let e=async()=>{try{let e=localStorage.getItem("accessToken"),r=localStorage.getItem("publicToken"),t={};if(e)t.Authorization=`Bearer ${e}`;else if(r)t.Authorization=`Bearer ${r}`;else{g("Authentication required"),c(!1);return}let a=await fetch(`/api/v1/tickets/${o}`,{headers:t}),s=await a.json();if(!s.success)return void g(s.error?.message||"Failed to load ticket");l(s.data)}catch(e){g("Failed to load ticket")}finally{c(!1)}};o&&e()},[o]);let k=async()=>{if(y.trim()&&j){p(!0);try{let e=localStorage.getItem("accessToken"),r=await fetch(`/api/v1/tickets/${o}/comments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({body:y})});if((await r.json()).success){u("");let r=await fetch(`/api/v1/tickets/${o}`,{headers:{Authorization:`Bearer ${e}`}}),t=await r.json();t.success&&l(t.data)}}catch(e){}finally{p(!1)}}},C=async e=>{if(j){b(!0);try{let r=localStorage.getItem("accessToken"),t=await fetch(`/api/v1/tickets/${o}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({status:e})}),a=await t.json();a.success&&l(a.data)}catch(e){}finally{b(!1)}}};return d?(0,r.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)("p",{children:"Loading ticket..."})}):m?(0,r.jsx)("div",{style:{minHeight:"100vh",padding:"2rem",color:"var(--error)"},children:m}):n?(0,r.jsx)("div",{style:{minHeight:"100vh",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)"},children:(0,r.jsxs)("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"2rem"},children:[(0,r.jsx)(s.default,{href:`/tenant/${i}/tickets`,style:{color:"var(--text-secondary)",textDecoration:"none",marginBottom:"2rem",display:"inline-block"},children:"â† Back to Tickets"}),(0,r.jsxs)("div",{style:{display:"grid",gap:"1.5rem"},children:[(0,r.jsxs)("div",{style:{padding:"1.5rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[(0,r.jsx)("span",{style:{fontWeight:600},children:n.ticketNumber}),(0,r.jsx)("span",{style:{color:"var(--text-secondary)"},children:new Date(n.createdAt).toLocaleString()})]}),(0,r.jsx)("h1",{style:{marginBottom:"0.5rem"},children:n.subject}),(0,r.jsx)("p",{style:{color:"var(--text-secondary)",marginBottom:"0.75rem"},children:n.description}),(0,r.jsxs)("div",{style:{padding:"1rem",backgroundColor:"var(--bg-primary)",borderRadius:"8px",marginBottom:"1rem"},children:[(0,r.jsx)("h3",{style:{margin:0,marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:600},children:"Submitted By"}),n.requester?(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{style:{margin:0,fontSize:"0.875rem"},children:n.requester.firstName&&n.requester.lastName?`${n.requester.firstName} ${n.requester.lastName}`:n.requester.email}),(0,r.jsx)("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",color:"var(--text-secondary)"},children:n.requester.email})]}):(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{style:{margin:0,fontSize:"0.875rem"},children:n.requesterName||"Anonymous"}),n.requesterEmail&&(0,r.jsx)("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",color:"var(--text-secondary)"},children:n.requesterEmail})]})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem",flexWrap:"wrap"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",display:"block",marginBottom:"0.25rem"},children:"Status"}),j&&v?.roles?.some(e=>["ADMIN","IT_MANAGER","AGENT"].includes(e))?(0,r.jsx)("select",{value:n.status,onChange:e=>C(e.target.value),disabled:x,style:{padding:"0.5rem",borderRadius:"6px",border:"1px solid var(--border-color)",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)"},children:["NEW","IN_PROGRESS","RESOLVED","CLOSED"].map(e=>(0,r.jsx)("option",{value:e,children:e},e))}):(0,r.jsx)("span",{style:{padding:"0.5rem 1rem",borderRadius:"6px",fontSize:"0.875rem",fontWeight:600,backgroundColor:"OPEN"===n.status||"NEW"===n.status?"rgba(59, 130, 246, 0.1)":"RESOLVED"===n.status||"CLOSED"===n.status?"rgba(16, 185, 129, 0.1)":"rgba(156, 163, 175, 0.1)",color:"OPEN"===n.status||"NEW"===n.status?"rgb(59, 130, 246)":"RESOLVED"===n.status||"CLOSED"===n.status?"rgb(16, 185, 129)":"rgb(156, 163, 175)"},children:n.status})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",display:"block",marginBottom:"0.25rem"},children:"Priority"}),(0,r.jsx)("span",{style:{padding:"0.5rem 1rem",borderRadius:"6px",fontSize:"0.875rem",backgroundColor:"var(--bg-primary)"},children:n.priority})]}),n.category&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",display:"block",marginBottom:"0.25rem"},children:"Category"}),(0,r.jsx)("span",{style:{padding:"0.5rem 1rem",borderRadius:"6px",fontSize:"0.875rem",backgroundColor:"var(--bg-primary)"},children:n.category})]})]}),n.customFields&&Object.keys(n.customFields).length>0&&(0,r.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,r.jsx)("h3",{style:{fontSize:"0.875rem",fontWeight:600,marginBottom:"0.5rem"},children:"Additional Information"}),(0,r.jsx)("div",{style:{display:"grid",gap:"0.5rem"},children:Object.entries(n.customFields).map(([e,t])=>(0,r.jsxs)("div",{style:{fontSize:"0.875rem"},children:[(0,r.jsxs)("strong",{children:[e,":"]})," ",String(t)]},e))})]}),n.assignee&&(0,r.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,r.jsx)("label",{style:{fontSize:"0.875rem",color:"var(--text-secondary)",display:"block",marginBottom:"0.25rem"},children:"Assigned To"}),(0,r.jsx)("span",{style:{fontSize:"0.875rem"},children:n.assignee.firstName&&n.assignee.lastName?`${n.assignee.firstName} ${n.assignee.lastName}`:n.assignee.email})]})]}),(0,r.jsxs)("div",{style:{padding:"1.5rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:[(0,r.jsx)("h2",{style:{marginBottom:"1rem"},children:"Comments"}),(0,r.jsxs)("div",{style:{display:"grid",gap:"1rem",marginBottom:"1.5rem"},children:[n.comments.map(e=>(0,r.jsxs)("div",{style:{padding:"1rem",backgroundColor:"var(--bg-primary)",borderRadius:"8px"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[(0,r.jsx)("strong",{style:{fontSize:"0.875rem"},children:e.author.firstName&&e.author.lastName?`${e.author.firstName} ${e.author.lastName}`:e.author.email}),(0,r.jsx)("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:new Date(e.createdAt).toLocaleString()})]}),(0,r.jsx)("p",{style:{margin:0,fontSize:"0.875rem",whiteSpace:"pre-wrap"},children:e.body})]},e.id)),0===n.comments.length&&(0,r.jsx)("p",{style:{color:"var(--text-secondary)",fontSize:"0.875rem"},children:"No comments yet."})]}),j&&(0,r.jsxs)("div",{children:[(0,r.jsx)("textarea",{value:y,onChange:e=>u(e.target.value),placeholder:"Add a comment...",rows:4,style:{width:"100%",padding:"0.75rem",borderRadius:"8px",border:"1px solid var(--border-color)",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontFamily:"inherit",fontSize:"0.875rem",marginBottom:"0.75rem",resize:"vertical"}}),(0,r.jsx)("button",{onClick:k,disabled:!y.trim()||h,style:{padding:"0.75rem 1.5rem",backgroundColor:"var(--accent-primary)",color:"white",border:"none",borderRadius:"8px",cursor:h?"not-allowed":"pointer",fontSize:"0.875rem",fontWeight:600,opacity:h?.6:1},children:h?"Posting...":"Post Comment"})]})]})]})]})}):null}e.s(["default",()=>i])}]);