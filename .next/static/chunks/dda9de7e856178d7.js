(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,38573,e=>{"use strict";var t=e.i(18050),a=e.i(71645),s=e.i(18566);function r(){let e=(0,s.useParams)(),r=e?.id,[o,l]=(0,a.useState)(null),[i,d]=(0,a.useState)(!0),[n,c]=(0,a.useState)(""),[m,y]=(0,a.useState)(""),[h,g]=(0,a.useState)(!1),[p,u]=(0,a.useState)(!1),[x,j]=(0,a.useState)(null),[v,b]=(0,a.useState)(!1),[f,S]=(0,a.useState)([]),[N,T]=(0,a.useState)(!1),[k,C]=(0,a.useState)({escalatedToRoleId:"",escalatedToSystemRole:"",escalationNote:""}),[R,w]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=localStorage.getItem("user");if(e)try{j(JSON.parse(e))}catch(e){}},[]),(0,a.useEffect)(()=>{let e=async()=>{try{let e=localStorage.getItem("accessToken"),t=await fetch(`/api/v1/tickets/${r}`,{headers:e?{Authorization:`Bearer ${e}`}:{}}),a=await t.json();if(!a.success)return void c("Failed to load ticket");l(a.data)}catch(e){c("Failed to load ticket")}finally{d(!1)}};r&&e()},[r]);let B=async()=>{if(m.trim()){g(!0),c("");try{let e=localStorage.getItem("accessToken"),t=await fetch(`/api/v1/tickets/${r}`,{method:"POST",headers:{"Content-Type":"application/json",...e?{Authorization:`Bearer ${e}`}:{}},body:JSON.stringify({body:m})}),a=await t.json();if(!a.success){c(a.error?.message||"Failed to add comment"),g(!1);return}l(e=>e?{...e,comments:[...e.comments,{...a.data,author:a.data.author}]}:e),y("")}catch(e){c("Failed to add comment")}finally{g(!1)}}},A=async e=>{u(!0),c("");try{let t=localStorage.getItem("accessToken"),a=await fetch(`/api/v1/tickets/${r}`,{method:"PATCH",headers:{"Content-Type":"application/json",...t?{Authorization:`Bearer ${t}`}:{}},body:JSON.stringify({status:e})}),s=await a.json();if(!s.success){c(s.error?.message||"Failed to update status"),u(!1);return}l(e=>e?{...e,status:s.data.status}:null)}catch(e){c("Failed to update status")}finally{u(!1)}},E=x?.roles?.some(e=>["AGENT","IT_MANAGER","ADMIN"].includes(e)||e.startsWith("CUSTOM:")),I=async()=>{T(!0);try{let e=localStorage.getItem("accessToken"),t=await fetch(`/api/v1/tickets/${r}/escalate`,{headers:e?{Authorization:`Bearer ${e}`}:{}}),a=await t.json();a.success&&S(a.data.availableRoles)}catch(e){console.error("Failed to load escalation roles:",e)}finally{T(!1)}},$=async()=>{if(!k.escalatedToRoleId&&!k.escalatedToSystemRole)return void c("Please select a role to escalate to");w(!0),c("");try{let e=localStorage.getItem("accessToken"),t=await fetch(`/api/v1/tickets/${r}/escalate`,{method:"POST",headers:{"Content-Type":"application/json",...e?{Authorization:`Bearer ${e}`}:{}},body:JSON.stringify({escalatedToRoleId:k.escalatedToRoleId||void 0,escalatedToSystemRole:k.escalatedToSystemRole||void 0,escalationNote:k.escalationNote||void 0})}),a=await t.json();if(!a.success){c(a.error?.message||"Failed to escalate ticket"),w(!1);return}let s=await fetch(`/api/v1/tickets/${r}`,{headers:e?{Authorization:`Bearer ${e}`}:{}}),o=await s.json();o.success&&l(o.data),b(!1),C({escalatedToRoleId:"",escalatedToSystemRole:"",escalationNote:""})}catch(e){c("Failed to escalate ticket")}finally{w(!1)}};return((0,a.useEffect)(()=>{v&&E&&I()},[v,E]),i)?(0,t.jsx)("div",{className:"container",style:{padding:"2rem"},children:"Loading ticket..."}):n?(0,t.jsx)("div",{className:"container",style:{padding:"2rem",color:"var(--error)"},children:n}):o?(0,t.jsxs)("div",{className:"container",style:{padding:"2rem",display:"grid",gap:"1.5rem"},children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[(0,t.jsx)("span",{style:{fontWeight:600},children:o.ticketNumber}),(0,t.jsx)("span",{style:{color:"var(--text-secondary)"},children:new Date(o.createdAt).toLocaleString()})]}),(0,t.jsx)("h1",{style:{marginBottom:"0.5rem"},children:o.subject}),(0,t.jsx)("p",{style:{color:"var(--text-secondary)",marginBottom:"0.75rem"},children:o.description}),(0,t.jsxs)("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",marginBottom:"1rem"},children:[(0,t.jsx)("h3",{style:{marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:600},children:"Submitted By"}),(0,t.jsxs)("div",{style:{display:"grid",gap:"0.25rem",fontSize:"0.875rem"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Name:"})," ",o.requester?o.requester.firstName&&o.requester.lastName?`${o.requester.firstName} ${o.requester.lastName}`:"Not provided":o.requesterName||"Not provided"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Email:"})," ",o.requester?.email||o.requesterEmail||"Not provided"]}),o.tenant&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Tenant:"})," ",o.tenant.name]}),o.category&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Category:"})," ",o.category]})]})]}),o.escalatedAt&&(0,t.jsxs)("div",{style:{padding:"1rem",backgroundColor:"rgba(251, 191, 36, 0.1)",border:"1px solid rgba(251, 191, 36, 0.3)",borderRadius:"8px",marginBottom:"1rem"},children:[(0,t.jsx)("h3",{style:{marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:600,color:"var(--warning)"},children:"âš  Escalated"}),(0,t.jsxs)("div",{style:{display:"grid",gap:"0.25rem",fontSize:"0.875rem"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Escalated to:"})," ",o.escalatedToCustomRole?o.escalatedToCustomRole.displayName:o.escalatedToSystemRole?.replace("_"," ")||"Unknown"]}),o.escalatedByUser&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Escalated by:"})," ",o.escalatedByUser.firstName&&o.escalatedByUser.lastName?`${o.escalatedByUser.firstName} ${o.escalatedByUser.lastName}`:o.escalatedByUser.email]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Escalated at:"})," ",new Date(o.escalatedAt).toLocaleString()]}),o.escalationNote&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Note:"})," ",o.escalationNote]})]})]}),(0,t.jsxs)("div",{style:{display:"flex",gap:"1rem",alignItems:"center",flexWrap:"wrap"},children:[(0,t.jsxs)("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[(0,t.jsx)("strong",{children:"Status:"}),E?(0,t.jsx)("select",{value:o.status,onChange:e=>A(e.target.value),disabled:p,style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid var(--border-color)",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",cursor:p?"not-allowed":"pointer"},children:["NEW","IN_PROGRESS","RESOLVED","CLOSED"].map(e=>(0,t.jsx)("option",{value:e,children:e.replace("_"," ")},e))}):(0,t.jsx)("span",{style:{color:"var(--text-secondary)"},children:o.status.replace("_"," ")})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Priority:"})," ",(0,t.jsx)("span",{style:{color:"var(--text-secondary)"},children:o.priority})]}),o.assignee&&(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Assigned to:"})," ",(0,t.jsx)("span",{style:{color:"var(--text-secondary)"},children:o.assignee.firstName&&o.assignee.lastName?`${o.assignee.firstName} ${o.assignee.lastName}`:o.assignee.email})]}),E&&!o.escalatedAt&&(0,t.jsx)("button",{onClick:()=>b(!0),style:{padding:"0.5rem 1rem",backgroundColor:"rgba(251, 191, 36, 0.1)",color:"var(--warning)",border:"1px solid rgba(251, 191, 36, 0.3)",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:600},children:"Escalate Ticket"})]}),n&&(0,t.jsx)("p",{style:{color:"var(--error)",marginTop:"0.5rem"},children:n})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{style:{marginBottom:"0.75rem"},children:"Comments"}),(0,t.jsxs)("div",{style:{display:"grid",gap:"0.5rem",marginBottom:"1rem"},children:[0===o.comments.length&&(0,t.jsx)("p",{style:{color:"var(--text-secondary)"},children:"No comments yet."}),o.comments.map(e=>(0,t.jsxs)("div",{style:{border:"1px solid var(--border-color)",borderRadius:"0.5rem",padding:"0.75rem"},children:[(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.25rem"},children:[(0,t.jsx)("span",{style:{fontWeight:500},children:e.author?.email??"Unknown"}),(0,t.jsx)("span",{style:{color:"var(--text-tertiary)",fontSize:"0.85rem"},children:new Date(e.createdAt).toLocaleString()})]}),(0,t.jsx)("p",{children:e.body})]},e.id))]}),(0,t.jsxs)("div",{style:{display:"grid",gap:"0.5rem"},children:[(0,t.jsx)("textarea",{className:"input",rows:3,placeholder:"Add a comment",value:m,onChange:e=>y(e.target.value),disabled:h}),(0,t.jsx)("button",{className:"btn btn-primary",onClick:B,disabled:h,children:h?"Adding...":"Add Comment"}),n&&(0,t.jsx)("p",{style:{color:"var(--error)"},children:n})]})]}),v&&(0,t.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>!R&&b(!1),children:(0,t.jsxs)("div",{style:{backgroundColor:"var(--bg-primary)",borderRadius:"8px",padding:"2rem",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto"},onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("h2",{style:{marginTop:0,marginBottom:"1.5rem"},children:"Escalate Ticket"}),(0,t.jsxs)("div",{style:{display:"grid",gap:"1rem"},children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:500},children:["Escalate to Role ",(0,t.jsx)("span",{style:{color:"var(--error)"},children:"*"})]}),N?(0,t.jsx)("p",{style:{color:"var(--text-secondary)"},children:"Loading roles..."}):(0,t.jsxs)("select",{className:"input",value:k.escalatedToSystemRole||k.escalatedToRoleId,onChange:e=>{let t=f.find(t=>(t.type,t.id===e.target.value));t&&("system"===t.type?C({...k,escalatedToSystemRole:t.id,escalatedToRoleId:""}):C({...k,escalatedToRoleId:t.id,escalatedToSystemRole:""}))},required:!0,disabled:R,children:[(0,t.jsx)("option",{value:"",children:"Select a role..."}),f.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.displayName," ","custom"===e.type?"(Custom)":""]},`${e.type}-${e.id}`))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:500},children:"Escalation Note (Optional)"}),(0,t.jsx)("textarea",{className:"input",rows:3,placeholder:"Add a note about why this ticket is being escalated...",value:k.escalationNote,onChange:e=>C({...k,escalationNote:e.target.value}),disabled:R})]}),(0,t.jsxs)("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1rem"},children:[(0,t.jsx)("button",{type:"button",onClick:()=>b(!1),disabled:R,style:{padding:"0.75rem 1.5rem",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",cursor:R?"not-allowed":"pointer",fontSize:"0.875rem"},children:"Cancel"}),(0,t.jsx)("button",{type:"button",className:"btn btn-primary",onClick:$,disabled:R||!k.escalatedToRoleId&&!k.escalatedToSystemRole,style:{backgroundColor:R?"var(--text-secondary)":"var(--warning)"},children:R?"Escalating...":"Escalate Ticket"})]})]})]})})]}):null}e.s(["default",()=>r])}]);