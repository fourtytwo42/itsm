module.exports=[70851,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944);function e(){let a=(0,d.useParams)(),e=a?.id,[f,g]=(0,c.useState)(null),[h,i]=(0,c.useState)(!0),[j,k]=(0,c.useState)(""),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)({escalatedToRoleId:"",escalatedToSystemRole:"",escalationNote:""}),[B,C]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let a=localStorage.getItem("user");if(a)try{s(JSON.parse(a))}catch(a){}},[]),(0,c.useEffect)(()=>{let a=async()=>{try{let a=localStorage.getItem("accessToken"),b=await fetch(`/api/v1/tickets/${e}`,{headers:a?{Authorization:`Bearer ${a}`}:{}}),c=await b.json();if(!c.success)return void k("Failed to load ticket");g(c.data)}catch(a){k("Failed to load ticket")}finally{i(!1)}};e&&a()},[e]);let D=async()=>{if(l.trim()){o(!0),k("");try{let a=localStorage.getItem("accessToken"),b=await fetch(`/api/v1/tickets/${e}`,{method:"POST",headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}},body:JSON.stringify({body:l})}),c=await b.json();if(!c.success){k(c.error?.message||"Failed to add comment"),o(!1);return}g(a=>a?{...a,comments:[...a.comments,{...c.data,author:c.data.author}]}:a),m("")}catch(a){k("Failed to add comment")}finally{o(!1)}}},E=async a=>{q(!0),k("");try{let b=localStorage.getItem("accessToken"),c=await fetch(`/api/v1/tickets/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json",...b?{Authorization:`Bearer ${b}`}:{}},body:JSON.stringify({status:a})}),d=await c.json();if(!d.success){k(d.error?.message||"Failed to update status"),q(!1);return}g(a=>a?{...a,status:d.data.status}:null)}catch(a){k("Failed to update status")}finally{q(!1)}},F=r?.roles?.some(a=>["AGENT","IT_MANAGER","ADMIN"].includes(a)||a.startsWith("CUSTOM:")),G=async()=>{y(!0);try{let a=localStorage.getItem("accessToken"),b=await fetch(`/api/v1/tickets/${e}/escalate`,{headers:a?{Authorization:`Bearer ${a}`}:{}}),c=await b.json();c.success&&w(c.data.availableRoles)}catch(a){console.error("Failed to load escalation roles:",a)}finally{y(!1)}},H=async()=>{if(!z.escalatedToRoleId&&!z.escalatedToSystemRole)return void k("Please select a role to escalate to");C(!0),k("");try{let a=localStorage.getItem("accessToken"),b=await fetch(`/api/v1/tickets/${e}/escalate`,{method:"POST",headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}},body:JSON.stringify({escalatedToRoleId:z.escalatedToRoleId||void 0,escalatedToSystemRole:z.escalatedToSystemRole||void 0,escalationNote:z.escalationNote||void 0})}),c=await b.json();if(!c.success){k(c.error?.message||"Failed to escalate ticket"),C(!1);return}let d=await fetch(`/api/v1/tickets/${e}`,{headers:a?{Authorization:`Bearer ${a}`}:{}}),f=await d.json();f.success&&g(f.data),u(!1),A({escalatedToRoleId:"",escalatedToSystemRole:"",escalationNote:""})}catch(a){k("Failed to escalate ticket")}finally{C(!1)}};return((0,c.useEffect)(()=>{t&&F&&G()},[t,F]),h)?(0,b.jsx)("div",{className:"container",style:{padding:"2rem"},children:"Loading ticket..."}):j?(0,b.jsx)("div",{className:"container",style:{padding:"2rem",color:"var(--error)"},children:j}):f?(0,b.jsxs)("div",{className:"container",style:{padding:"2rem",display:"grid",gap:"1.5rem"},children:[(0,b.jsxs)("div",{className:"card",children:[(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[(0,b.jsx)("span",{style:{fontWeight:600},children:f.ticketNumber}),(0,b.jsx)("span",{style:{color:"var(--text-secondary)"},children:new Date(f.createdAt).toLocaleString()})]}),(0,b.jsx)("h1",{style:{marginBottom:"0.5rem"},children:f.subject}),(0,b.jsx)("p",{style:{color:"var(--text-secondary)",marginBottom:"0.75rem"},children:f.description}),(0,b.jsxs)("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",marginBottom:"1rem"},children:[(0,b.jsx)("h3",{style:{marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:600},children:"Submitted By"}),(0,b.jsxs)("div",{style:{display:"grid",gap:"0.25rem",fontSize:"0.875rem"},children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Name:"})," ",f.requester?f.requester.firstName&&f.requester.lastName?`${f.requester.firstName} ${f.requester.lastName}`:"Not provided":f.requesterName||"Not provided"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Email:"})," ",f.requester?.email||f.requesterEmail||"Not provided"]}),f.tenant&&(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Tenant:"})," ",f.tenant.name]}),f.category&&(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Category:"})," ",f.category]})]})]}),f.escalatedAt&&(0,b.jsxs)("div",{style:{padding:"1rem",backgroundColor:"rgba(251, 191, 36, 0.1)",border:"1px solid rgba(251, 191, 36, 0.3)",borderRadius:"8px",marginBottom:"1rem"},children:[(0,b.jsx)("h3",{style:{marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:600,color:"var(--warning)"},children:"âš  Escalated"}),(0,b.jsxs)("div",{style:{display:"grid",gap:"0.25rem",fontSize:"0.875rem"},children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Escalated to:"})," ",f.escalatedToCustomRole?f.escalatedToCustomRole.displayName:f.escalatedToSystemRole?.replace("_"," ")||"Unknown"]}),f.escalatedByUser&&(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Escalated by:"})," ",f.escalatedByUser.firstName&&f.escalatedByUser.lastName?`${f.escalatedByUser.firstName} ${f.escalatedByUser.lastName}`:f.escalatedByUser.email]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Escalated at:"})," ",new Date(f.escalatedAt).toLocaleString()]}),f.escalationNote&&(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Note:"})," ",f.escalationNote]})]})]}),(0,b.jsxs)("div",{style:{display:"flex",gap:"1rem",alignItems:"center",flexWrap:"wrap"},children:[(0,b.jsxs)("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[(0,b.jsx)("strong",{children:"Status:"}),F?(0,b.jsx)("select",{value:f.status,onChange:a=>E(a.target.value),disabled:p,style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid var(--border-color)",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",cursor:p?"not-allowed":"pointer"},children:["NEW","IN_PROGRESS","RESOLVED","CLOSED"].map(a=>(0,b.jsx)("option",{value:a,children:a.replace("_"," ")},a))}):(0,b.jsx)("span",{style:{color:"var(--text-secondary)"},children:f.status.replace("_"," ")})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Priority:"})," ",(0,b.jsx)("span",{style:{color:"var(--text-secondary)"},children:f.priority})]}),f.assignee&&(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Assigned to:"})," ",(0,b.jsx)("span",{style:{color:"var(--text-secondary)"},children:f.assignee.firstName&&f.assignee.lastName?`${f.assignee.firstName} ${f.assignee.lastName}`:f.assignee.email})]}),F&&!f.escalatedAt&&(0,b.jsx)("button",{onClick:()=>u(!0),style:{padding:"0.5rem 1rem",backgroundColor:"rgba(251, 191, 36, 0.1)",color:"var(--warning)",border:"1px solid rgba(251, 191, 36, 0.3)",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:600},children:"Escalate Ticket"})]}),j&&(0,b.jsx)("p",{style:{color:"var(--error)",marginTop:"0.5rem"},children:j})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{style:{marginBottom:"0.75rem"},children:"Comments"}),(0,b.jsxs)("div",{style:{display:"grid",gap:"0.5rem",marginBottom:"1rem"},children:[0===f.comments.length&&(0,b.jsx)("p",{style:{color:"var(--text-secondary)"},children:"No comments yet."}),f.comments.map(a=>(0,b.jsxs)("div",{style:{border:"1px solid var(--border-color)",borderRadius:"0.5rem",padding:"0.75rem"},children:[(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.25rem"},children:[(0,b.jsx)("span",{style:{fontWeight:500},children:a.author?.email??"Unknown"}),(0,b.jsx)("span",{style:{color:"var(--text-tertiary)",fontSize:"0.85rem"},children:new Date(a.createdAt).toLocaleString()})]}),(0,b.jsx)("p",{children:a.body})]},a.id))]}),(0,b.jsxs)("div",{style:{display:"grid",gap:"0.5rem"},children:[(0,b.jsx)("textarea",{className:"input",rows:3,placeholder:"Add a comment",value:l,onChange:a=>m(a.target.value),disabled:n}),(0,b.jsx)("button",{className:"btn btn-primary",onClick:D,disabled:n,children:n?"Adding...":"Add Comment"}),j&&(0,b.jsx)("p",{style:{color:"var(--error)"},children:j})]})]}),t&&(0,b.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>!B&&u(!1),children:(0,b.jsxs)("div",{style:{backgroundColor:"var(--bg-primary)",borderRadius:"8px",padding:"2rem",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto"},onClick:a=>a.stopPropagation(),children:[(0,b.jsx)("h2",{style:{marginTop:0,marginBottom:"1.5rem"},children:"Escalate Ticket"}),(0,b.jsxs)("div",{style:{display:"grid",gap:"1rem"},children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:500},children:["Escalate to Role ",(0,b.jsx)("span",{style:{color:"var(--error)"},children:"*"})]}),x?(0,b.jsx)("p",{style:{color:"var(--text-secondary)"},children:"Loading roles..."}):(0,b.jsxs)("select",{className:"input",value:z.escalatedToSystemRole||z.escalatedToRoleId,onChange:a=>{let b=v.find(b=>(b.type,b.id===a.target.value));b&&("system"===b.type?A({...z,escalatedToSystemRole:b.id,escalatedToRoleId:""}):A({...z,escalatedToRoleId:b.id,escalatedToSystemRole:""}))},required:!0,disabled:B,children:[(0,b.jsx)("option",{value:"",children:"Select a role..."}),v.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.displayName," ","custom"===a.type?"(Custom)":""]},`${a.type}-${a.id}`))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:500},children:"Escalation Note (Optional)"}),(0,b.jsx)("textarea",{className:"input",rows:3,placeholder:"Add a note about why this ticket is being escalated...",value:z.escalationNote,onChange:a=>A({...z,escalationNote:a.target.value}),disabled:B})]}),(0,b.jsxs)("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1rem"},children:[(0,b.jsx)("button",{type:"button",onClick:()=>u(!1),disabled:B,style:{padding:"0.75rem 1.5rem",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",cursor:B?"not-allowed":"pointer",fontSize:"0.875rem"},children:"Cancel"}),(0,b.jsx)("button",{type:"button",className:"btn btn-primary",onClick:H,disabled:B||!z.escalatedToRoleId&&!z.escalatedToSystemRole,style:{backgroundColor:B?"var(--text-secondary)":"var(--warning)"},children:B?"Escalating...":"Escalate Ticket"})]})]})]})})]}):null}a.s(["default",()=>e])}];

//# sourceMappingURL=app_tickets_%5Bid%5D_page_tsx_966bf88f._.js.map