module.exports=[28025,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(38246),f=a.i(23502),g=a.i(89329),h=a.i(60536),i=a.i(74094),j=a.i(3471),k=a.i(62180),l=a.i(58348),m=a.i(5276);function n({tenantId:a}){let[d,e]=(0,c.useState)(!1),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(()=>[{role:"assistant",content:"Hi! I'm your IT support assistant. What issue are you experiencing?"}]),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(!1),x=(0,c.useRef)(null),y=(0,c.useRef)(null),z=(0,c.useRef)(!1);(0,c.useEffect)(()=>{x.current?.scrollIntoView({behavior:"smooth"})},[r]),(0,c.useEffect)(()=>{!v&&z.current&&y.current&&setTimeout(()=>{y.current?.focus()},100)},[r,v]);let A=(0,c.useRef)(!1);(0,c.useEffect)(()=>{if(A.current){A.current=!1;return}},[r,a]);let B=async()=>{if(!t.trim()||v)return void console.log("[TenantChatWidget] handleSend: Skipping - input empty or already loading",{input:t.trim(),loading:v,tenantId:a});let b=[...r,{role:"user",content:t}];console.log("[TenantChatWidget] handleSend: Starting",{messageCount:b.length,userMessage:t.substring(0,50),tenantId:a}),s(b),u(""),w(!0);try{let c,d=localStorage.getItem("accessToken"),e={messages:b.map(a=>({role:a.role,content:a.content})),tenantId:a};console.log("[TenantChatWidget] handleSend: Sending request",{messageCount:e.messages.length,hasToken:!!d,tenantId:a});let f=new AbortController,g=setTimeout(()=>{console.error("[TenantChatWidget] handleSend: Request timeout after 60s",{tenantId:a}),f.abort()},6e4);try{c=await fetch("/api/v1/ai/chat",{method:"POST",headers:{"Content-Type":"application/json",...d&&{Authorization:`Bearer ${d}`}},body:JSON.stringify(e),signal:f.signal}),clearTimeout(g)}catch(a){if(clearTimeout(g),a instanceof Error&&"AbortError"===a.name)throw Error("Request timeout - the server took too long to respond. Please try again.");throw a}if(console.log("[TenantChatWidget] handleSend: Response received",{status:c.status,ok:c.ok,tenantId:a}),!c.ok){let b=await c.text();throw console.error("[TenantChatWidget] handleSend: HTTP Error",{status:c.status,statusText:c.statusText,errorText:b.substring(0,200),tenantId:a}),Error(`HTTP ${c.status}: ${c.statusText}`)}let h=await c.json();if(console.log("[TenantChatWidget] handleSend: Response parsed",{success:h.success,hasReply:!!h.data?.reply,replyLength:h.data?.reply?.length||0,tenantId:a}),!h.success)throw console.error("[TenantChatWidget] handleSend: API Error Response",{error:h.error,errorCode:h.error?.code,errorMessage:h.error?.message,tenantId:a}),Error(h.error?.message||"Failed to get response");if(!h.data?.reply)throw console.error("[TenantChatWidget] handleSend: No reply in response",{data:h,tenantId:a}),Error("No reply received from server");h.data.conversationId&&(console.log("[TenantChatWidget] handleSend: Conversation ID updated",{conversationId:h.data.conversationId,tenantId:a}),q(h.data.conversationId));let i={role:"assistant",content:h.data.reply};console.log("[TenantChatWidget] handleSend: Adding assistant message",{messageLength:i.content.length,tenantId:a}),s(b=>{let c=[...b,i];return console.log("[TenantChatWidget] handleSend: Messages updated",{totalMessages:c.length,tenantId:a}),c})}catch(c){console.error("[TenantChatWidget] handleSend: Exception caught",{error:c,errorMessage:c instanceof Error?c.message:String(c),errorStack:c instanceof Error?c.stack:void 0,tenantId:a});let b={role:"assistant",content:`Sorry, I encountered an error. Please try again or create a support ticket. Error: ${c instanceof Error?c.message:"Unknown error"}`};s(a=>[...a,b])}finally{console.log("[TenantChatWidget] handleSend: Finalizing (setting loading to false)",{tenantId:a}),w(!1)}};return d?(0,b.jsxs)("div",{style:n?{position:"fixed",top:0,left:0,right:0,bottom:0,width:"100vw",height:"100vh",backgroundColor:"var(--bg-secondary)",border:"none",borderRadius:0,boxShadow:"none",display:"flex",flexDirection:"column",zIndex:9999}:{position:"fixed",bottom:"2rem",right:"2rem",width:"600px",maxWidth:"calc(100vw - 40px)",height:"800px",maxHeight:"calc(100vh - 40px)",backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"12px",boxShadow:"0 8px 24px var(--shadow)",display:"flex",flexDirection:"column",zIndex:1e3},children:[(0,b.jsxs)("div",{style:{padding:"0.75rem",borderBottom:"1px solid var(--border-color)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,b.jsx)("h3",{style:{margin:0,fontWeight:"600",fontSize:"0.875rem"},children:"AI Assistant"}),(0,b.jsxs)("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[(0,b.jsx)("button",{onClick:()=>{A.current=!0,q(null),s([{role:"assistant",content:"Hi! I'm your IT support assistant. What issue are you experiencing?"}])},style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center"},"aria-label":"Clear chat",title:"Clear chat",children:(0,b.jsx)(j.TrashIcon,{style:{width:"20px",height:"20px"}})}),(0,b.jsx)("button",{onClick:()=>{o(!n)},style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem",display:"flex",alignItems:"center"},"aria-label":n?"Exit fullscreen":"Enter fullscreen",title:n?"Exit fullscreen":"Enter fullscreen",children:n?(0,b.jsx)(i.ArrowsPointingInIcon,{style:{width:"20px",height:"20px"}}):(0,b.jsx)(h.ArrowsPointingOutIcon,{style:{width:"20px",height:"20px"}})}),(0,b.jsx)("button",{onClick:()=>e(!1),style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",padding:"0.25rem"},"aria-label":"Close chat",children:(0,b.jsx)(g.XMarkIcon,{style:{width:"20px",height:"20px"}})})]})]}),(0,b.jsxs)("div",{style:{flex:1,overflowY:"auto",padding:"0.75rem",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[r.map((a,c)=>(0,b.jsx)("div",{style:{alignSelf:"user"===a.role?"flex-end":"flex-start",maxWidth:"80%",padding:"0.5rem 0.75rem",borderRadius:"12px",backgroundColor:"user"===a.role?"var(--accent-primary)":"var(--bg-tertiary)",color:"user"===a.role?"white":"var(--text-primary)",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap",fontSize:"0.8125rem",lineHeight:1.5},children:"assistant"===a.role?(0,b.jsx)("div",{style:{lineHeight:1.4,fontSize:"0.8125rem"},children:(0,b.jsx)(k.default,{remarkPlugins:[l.default],rehypePlugins:[m.default],components:{p:({children:a})=>(0,b.jsx)("p",{style:{margin:"0 0 0.375rem 0",fontSize:"0.8125rem"},children:a}),ul:({children:a})=>(0,b.jsx)("ul",{style:{margin:"0 0 0.5rem 0",paddingLeft:"1.5rem"},children:a}),ol:({children:a})=>(0,b.jsx)("ol",{style:{margin:"0 0 0.5rem 0",paddingLeft:"1.5rem"},children:a}),li:({children:a})=>(0,b.jsx)("li",{style:{margin:"0.25rem 0"},children:a}),code:({children:a,className:c})=>(0,b.jsx)("code",{style:{backgroundColor:"rgba(0,0,0,0.1)",padding:"0.15rem 0.3rem",borderRadius:"4px",fontSize:"0.75em",fontFamily:"monospace"},children:a}),pre:({children:a})=>(0,b.jsx)("pre",{style:{backgroundColor:"rgba(0,0,0,0.1)",padding:"0.5rem",borderRadius:"8px",overflowX:"auto",margin:"0.375rem 0",fontSize:"0.75em",fontFamily:"monospace"},children:a}),a:({children:a,href:c})=>(0,b.jsx)("a",{href:c,target:"_blank",rel:"noopener noreferrer",style:{color:"inherit",textDecoration:"underline"},children:a}),strong:({children:a})=>(0,b.jsx)("strong",{style:{fontWeight:600},children:a}),em:({children:a})=>(0,b.jsx)("em",{style:{fontStyle:"italic"},children:a})},children:a.content})}):(0,b.jsx)("div",{style:{fontSize:"0.8125rem"},children:a.content})},c)),v&&(0,b.jsx)("div",{style:{alignSelf:"flex-start",padding:"0.5rem 0.75rem",borderRadius:"12px",backgroundColor:"var(--bg-tertiary)",color:"var(--text-secondary)",fontSize:"0.8125rem"},children:"Thinking..."}),(0,b.jsx)("div",{ref:x})]}),(0,b.jsxs)("div",{style:{padding:"0.75rem",borderTop:"1px solid var(--border-color)",display:"flex",gap:"0.5rem"},children:[(0,b.jsx)("input",{ref:y,type:"text",value:t,onChange:a=>u(a.target.value),onKeyPress:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),B())},onFocus:()=>{z.current=!0},onBlur:()=>{setTimeout(()=>{document.activeElement!==y.current&&(z.current=!1)},100)},placeholder:"Type your message...",disabled:v,style:{flex:1,padding:"0.5rem 0.75rem",border:"1px solid var(--border-color)",borderRadius:"8px",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"0.75rem"}}),(0,b.jsx)("button",{onClick:B,disabled:v||!t.trim(),style:{padding:"0.5rem 0.75rem",backgroundColor:"var(--accent-primary)",color:"white",border:"none",borderRadius:"8px",cursor:v||!t.trim()?"not-allowed":"pointer",opacity:v||!t.trim()?.5:1},children:(0,b.jsx)(f.PaperAirplaneIcon,{style:{width:"20px",height:"20px"}})})]})]}):(0,b.jsx)("button",{onClick:()=>e(!0),style:{position:"fixed",bottom:"2rem",right:"2rem",width:"60px",height:"60px",borderRadius:"50%",backgroundColor:"var(--accent-primary)",color:"white",border:"none",cursor:"pointer",boxShadow:"0 4px 12px var(--shadow)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},"aria-label":"Open chat",children:(0,b.jsx)(f.PaperAirplaneIcon,{style:{width:"24px",height:"24px"}})})}function o(){let a=(0,d.useParams)(),f=(0,d.useRouter)(),g=a?.slug,[h,i]=(0,c.useState)(null),[j,k]=(0,c.useState)(!0),[l,m]=(0,c.useState)(""),[o,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(null);(0,c.useEffect)(()=>{let a=localStorage.getItem("accessToken");if(p(!!a),!a){let a=localStorage.getItem("publicToken");a?v(a):w()}x()},[g]),(0,c.useEffect)(()=>{h&&y()},[h,o,u]);let w=async a=>{try{let b=await fetch("/api/v1/public/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tenantId:a||null})}),c=await b.json();c.success&&(localStorage.setItem("publicToken",c.data.token),localStorage.setItem("publicTokenId",c.data.publicId),v(c.data.token))}catch(a){}};(0,c.useEffect)(()=>{!h||o||u||w(h.id)},[h?.id,o]);let x=async()=>{try{k(!0);let a=await fetch(`/api/v1/tenants/${g}`),b=await a.json();b.success?(i(b.data),b.data.requiresLogin&&!o&&f.push(`/login?redirect=/tenant/${g}`)):m(b.error?.message||"Tenant not found")}catch(a){m("Failed to load tenant")}finally{k(!1)}},y=async()=>{try{t(!0);let a=localStorage.getItem("accessToken"),b=u||localStorage.getItem("publicToken"),c={"Content-Type":"application/json"};a?c.Authorization=`Bearer ${a}`:b&&(c.Authorization=`Bearer ${b}`);let d=await fetch(`/api/v1/tenants/${g}/tickets`,{headers:c}),e=await d.json();e.success&&(r(e.data),e.data.length>0&&localStorage.setItem(`tickets_${g}`,JSON.stringify(e.data)))}catch(b){let a=localStorage.getItem(`tickets_${g}`);if(a)try{r(JSON.parse(a))}catch(a){}}finally{t(!1)}};return j?(0,b.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,b.jsx)("p",{children:"Loading..."})}):l||!h?(0,b.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,b.jsxs)("div",{style:{textAlign:"center"},children:[(0,b.jsx)("h1",{style:{fontSize:"2rem",marginBottom:"1rem"},children:"Tenant Not Found"}),(0,b.jsx)("p",{style:{color:"var(--text-secondary)"},children:l||"The tenant you are looking for does not exist."})]})}):(0,b.jsxs)("div",{style:{minHeight:"100vh",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)"},children:[(0,b.jsx)("header",{style:{padding:"2rem",borderBottom:"1px solid var(--border-color)",backgroundColor:"var(--bg-secondary)"},children:(0,b.jsxs)("div",{style:{maxWidth:"1200px",margin:"0 auto",display:"flex",alignItems:"center",gap:"1rem"},children:[h.logo&&(0,b.jsx)("img",{src:h.logo,alt:h.name,style:{width:"64px",height:"64px",borderRadius:"8px"}}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{style:{fontSize:"2rem",margin:0},children:h.name}),h.description&&(0,b.jsx)("p",{style:{color:"var(--text-secondary)",marginTop:"0.5rem"},children:h.description})]})]})}),(0,b.jsx)("nav",{style:{padding:"1rem 2rem",borderBottom:"1px solid var(--border-color)",backgroundColor:"var(--bg-secondary)"},children:(0,b.jsxs)("div",{style:{maxWidth:"1200px",margin:"0 auto",display:"flex",gap:"2rem"},children:[(0,b.jsx)(e.default,{href:`/tenant/${g}`,style:{color:"var(--accent-primary)",textDecoration:"none",fontWeight:600},children:"Home"}),(0,b.jsx)(e.default,{href:`/tenant/${g}/kb`,style:{color:"var(--text-primary)",textDecoration:"none"},children:"Knowledge Base"}),(0,b.jsx)(e.default,{href:`/tenant/${g}/submit`,style:{color:"var(--text-primary)",textDecoration:"none"},children:"Submit Ticket"})]})}),(0,b.jsx)("main",{style:{maxWidth:"1200px",margin:"0 auto",padding:"2rem"},children:(0,b.jsx)("div",{children:(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{style:{fontSize:"1.5rem",marginBottom:"1rem"},children:["Welcome to ",h.name," Support"]}),(0,b.jsx)("p",{style:{color:"var(--text-secondary)",marginBottom:"2rem"},children:"We're here to help! Browse our knowledge base or submit a support ticket."}),(0,b.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"2rem"},children:[(0,b.jsxs)(e.default,{href:`/tenant/${g}/submit`,style:{padding:"1.5rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)",textDecoration:"none",color:"var(--text-primary)",display:"block"},children:[(0,b.jsx)("h3",{style:{margin:0,marginBottom:"0.5rem"},children:"Submit a Ticket"}),(0,b.jsx)("p",{style:{margin:0,color:"var(--text-secondary)",fontSize:"0.875rem"},children:"Get help with your issue"})]}),(0,b.jsxs)(e.default,{href:`/tenant/${g}/kb`,style:{padding:"1.5rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)",textDecoration:"none",color:"var(--text-primary)",display:"block"},children:[(0,b.jsx)("h3",{style:{margin:0,marginBottom:"0.5rem"},children:"Knowledge Base"}),(0,b.jsx)("p",{style:{margin:0,color:"var(--text-secondary)",fontSize:"0.875rem"},children:"Browse articles and FAQs"})]})]}),(o||u||localStorage.getItem("publicToken"))&&(0,b.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,b.jsx)("h3",{style:{fontSize:"1.25rem",margin:0},children:"My Tickets"}),q.length>5&&(0,b.jsx)(e.default,{href:`/tenant/${g}/tickets`,style:{fontSize:"0.875rem",color:"var(--accent-primary)",textDecoration:"none"},children:"View All"})]}),s?(0,b.jsx)("p",{style:{color:"var(--text-secondary)"},children:"Loading tickets..."}):q.length>0?(0,b.jsx)("div",{style:{display:"grid",gap:"1rem"},children:q.slice(0,5).map(a=>(0,b.jsxs)(e.default,{href:`/tenant/${g}/tickets/${a.id}`,style:{padding:"1rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)",textDecoration:"none",color:"var(--text-primary)",display:"block"},children:[(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[(0,b.jsx)("span",{style:{fontWeight:600},children:a.ticketNumber}),(0,b.jsx)("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"12px",fontSize:"0.75rem",fontWeight:600,backgroundColor:"OPEN"===a.status||"NEW"===a.status?"rgba(59, 130, 246, 0.1)":"RESOLVED"===a.status||"CLOSED"===a.status?"rgba(16, 185, 129, 0.1)":"rgba(156, 163, 175, 0.1)",color:"OPEN"===a.status||"NEW"===a.status?"rgb(59, 130, 246)":"RESOLVED"===a.status||"CLOSED"===a.status?"rgb(16, 185, 129)":"rgb(156, 163, 175)"},children:a.status})]}),(0,b.jsx)("h4",{style:{margin:0,marginBottom:"0.25rem"},children:a.subject}),(0,b.jsx)("p",{style:{margin:0,color:"var(--text-secondary)",fontSize:"0.875rem"},children:new Date(a.createdAt).toLocaleDateString()})]},a.id))}):(0,b.jsx)("p",{style:{color:"var(--text-secondary)"},children:"No tickets yet. Submit a ticket to get started!"})]}),h.kbArticles.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{style:{fontSize:"1.25rem",marginBottom:"1rem"},children:"Popular Articles"}),(0,b.jsx)("div",{style:{display:"grid",gap:"1rem"},children:h.kbArticles.slice(0,5).map(a=>(0,b.jsx)(e.default,{href:`/tenant/${g}/kb/${a.id}`,style:{padding:"1rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)",textDecoration:"none",color:"var(--text-primary)",display:"block"},children:a.title},a.id))})]})]})})}),(0,b.jsx)(n,{tenantId:h.id})]})}a.s(["default",()=>o],28025)}];

//# sourceMappingURL=app_tenant_%5Bslug%5D_page_tsx_54d88b1f._.js.map